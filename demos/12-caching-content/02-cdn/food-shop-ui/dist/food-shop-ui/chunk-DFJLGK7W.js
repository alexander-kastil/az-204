import{a as T,b,c as ur,d as mr,e as d}from"./chunk-4ONZQGSC.js";var a={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},ve=[a.OPENID_SCOPE,a.PROFILE_SCOPE,a.OFFLINE_ACCESS_SCOPE],pr=[...ve,a.EMAIL_SCOPE],te={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},j={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Fe={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},R={CLIENT_ID:"client_id",REDIRECT_URI:"redirect_uri",RESPONSE_TYPE:"response_type",RESPONSE_MODE:"response_mode",GRANT_TYPE:"grant_type",CLAIMS:"claims",SCOPE:"scope",ERROR:"error",ERROR_DESCRIPTION:"error_description",ACCESS_TOKEN:"access_token",ID_TOKEN:"id_token",REFRESH_TOKEN:"refresh_token",EXPIRES_IN:"expires_in",STATE:"state",NONCE:"nonce",PROMPT:"prompt",SESSION_STATE:"session_state",CLIENT_INFO:"client_info",CODE:"code",CODE_CHALLENGE:"code_challenge",CODE_CHALLENGE_METHOD:"code_challenge_method",CODE_VERIFIER:"code_verifier",CLIENT_REQUEST_ID:"client-request-id",X_CLIENT_SKU:"x-client-SKU",X_CLIENT_VER:"x-client-VER",X_CLIENT_OS:"x-client-OS",X_CLIENT_CPU:"x-client-CPU",X_CLIENT_CURR_TELEM:"x-client-current-telemetry",X_CLIENT_LAST_TELEM:"x-client-last-telemetry",X_MS_LIB_CAPABILITY:"x-ms-lib-capability",X_APP_NAME:"x-app-name",X_APP_VER:"x-app-ver",POST_LOGOUT_URI:"post_logout_redirect_uri",ID_TOKEN_HINT:"id_token_hint",DEVICE_CODE:"device_code",CLIENT_SECRET:"client_secret",CLIENT_ASSERTION:"client_assertion",CLIENT_ASSERTION_TYPE:"client_assertion_type",TOKEN_TYPE:"token_type",REQ_CNF:"req_cnf",OBO_ASSERTION:"assertion",REQUESTED_TOKEN_USE:"requested_token_use",ON_BEHALF_OF:"on_behalf_of",FOCI:"foci",CCS_HEADER:"X-AnchorMailbox",RETURN_SPA_CODE:"return_spa_code",NATIVE_BROKER:"nativebroker",LOGOUT_HINT:"logout_hint"},lt={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},$={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},_t={ACCOUNT:"account",SID:"sid",LOGIN_HINT:"login_hint",ID_TOKEN:"id_token",DOMAIN_HINT:"domain_hint",ORGANIZATIONS:"organizations",CONSUMERS:"consumers",ACCOUNT_ID:"accountIdentifier",HOMEACCOUNT_ID:"homeAccountIdentifier"},Dt={PLAIN:"plain",S256:"S256"},St={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},wt={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Pe={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},q={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},A={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},ke={ADFS:1001,MSA:1002,MSSTS:1003,GENERIC:1004,ACCESS_TOKEN:2001,REFRESH_TOKEN:2002,ID_TOKEN:2003,APP_METADATA:3001,UNDEFINED:9999},At="appmetadata",Sr="client_info",qe="1",We={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Se={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},J={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},P={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Me={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},xt={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Lt={username:"username",password:"password"},vt={httpSuccess:200,httpBadRequest:400},je={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Kt={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Be={NO_CACHE_HIT:"0",FORCE_REFRESH:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",REFRESH_CACHED_ACCESS_TOKEN:"4"},wr={Jwt:"JWT",Jwk:"JWK",Pop:"pop"};var kt={unexpectedError:{code:"unexpected_error",desc:"Unexpected error in authentication."},postRequestFailed:{code:"post_request_failed",desc:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."}},y=class extends Error{constructor(e,t,r){let o=t?`${e}: ${t}`:e;super(o),Object.setPrototypeOf(this,y.prototype),this.errorCode=e||a.EMPTY_STRING,this.errorMessage=t||a.EMPTY_STRING,this.subError=r||a.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}static createUnexpectedError(e){return new y(kt.unexpectedError.code,`${kt.unexpectedError.desc}: ${e}`)}static createPostRequestFailed(e){return new y(kt.postRequestFailed.code,`${kt.postRequestFailed.desc}: ${e}`)}};var Ge={createNewGuid:()=>{let p="Crypto interface - createNewGuid() has not been implemented";throw y.createUnexpectedError(p)},base64Decode:()=>{let p="Crypto interface - base64Decode() has not been implemented";throw y.createUnexpectedError(p)},base64Encode:()=>{let p="Crypto interface - base64Encode() has not been implemented";throw y.createUnexpectedError(p)},generatePkceCodes(){return d(this,null,function*(){let p="Crypto interface - generatePkceCodes() has not been implemented";throw y.createUnexpectedError(p)})},getPublicKeyThumbprint(){return d(this,null,function*(){let p="Crypto interface - getPublicKeyThumbprint() has not been implemented";throw y.createUnexpectedError(p)})},removeTokenBindingKey(){return d(this,null,function*(){let p="Crypto interface - removeTokenBindingKey() has not been implemented";throw y.createUnexpectedError(p)})},clearKeystore(){return d(this,null,function*(){let p="Crypto interface - clearKeystore() has not been implemented";throw y.createUnexpectedError(p)})},signJwt(){return d(this,null,function*(){let p="Crypto interface - signJwt() has not been implemented";throw y.createUnexpectedError(p)})},hashString(){return d(this,null,function*(){let p="Crypto interface - hashString() has not been implemented";throw y.createUnexpectedError(p)})}};var E={clientInfoDecodingError:{code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},clientInfoEmptyError:{code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},tokenParsingError:{code:"token_parsing_error",desc:"Token cannot be parsed. Please review stack trace to determine root cause."},nullOrEmptyToken:{code:"null_or_empty_token",desc:"The token is null or empty. Please review the trace to determine the root cause."},endpointResolutionError:{code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},networkError:{code:"network_error",desc:"Network request failed. Please check network trace to determine root cause."},unableToGetOpenidConfigError:{code:"openid_config_error",desc:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints."},hashNotDeserialized:{code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},blankGuidGenerated:{code:"blank_guid_generated",desc:"The guid generated was blank. Please review the trace to determine the root cause."},invalidStateError:{code:"invalid_state",desc:"State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState()."},stateMismatchError:{code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},stateNotFoundError:{code:"state_not_found",desc:"State not found"},nonceMismatchError:{code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},nonceNotFoundError:{code:"nonce_not_found",desc:"nonce not found"},authTimeNotFoundError:{code:"auth_time_not_found",desc:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information."},maxAgeTranspiredError:{code:"max_age_transpired",desc:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication."},noTokensFoundError:{code:"no_tokens_found",desc:"No tokens were found for the given scopes, and no authorization code was passed to acquireToken. You must retrieve an authorization code before making a call to acquireToken()."},multipleMatchingTokens:{code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},multipleMatchingAccounts:{code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},multipleMatchingAppMetadata:{code:"multiple_matching_appMetadata",desc:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata"},tokenRequestCannotBeMade:{code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},appendEmptyScopeError:{code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},removeEmptyScopeError:{code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},appendScopeSetError:{code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},emptyInputScopeSetError:{code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},DeviceCodePollingCancelled:{code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},DeviceCodeExpired:{code:"device_code_expired",desc:"Device code is expired."},DeviceCodeUnknownError:{code:"device_code_unknown_error",desc:"Device code stopped polling for unknown reasons."},NoAccountInSilentRequest:{code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"},invalidCacheRecord:{code:"invalid_cache_record",desc:"Cache record object was null or undefined."},invalidCacheEnvironment:{code:"invalid_cache_environment",desc:"Invalid environment when attempting to create cache entry"},noAccountFound:{code:"no_account_found",desc:"No account found in cache for given key."},CachePluginError:{code:"no cache plugin set on CacheManager",desc:"ICachePlugin needs to be set before using readFromStorage or writeFromStorage"},noCryptoObj:{code:"no_crypto_object",desc:"No crypto object detected. This is required for the following operation: "},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},unexpectedAccountType:{code:"unexpected_account_type",desc:"Unexpected account type."},unexpectedCredentialType:{code:"unexpected_credential_type",desc:"Unexpected credential type."},invalidAssertion:{code:"invalid_assertion",desc:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515"},invalidClientCredential:{code:"invalid_client_credential",desc:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential"},tokenRefreshRequired:{code:"token_refresh_required",desc:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired."},userTimeoutReached:{code:"user_timeout_reached",desc:"User defined timeout for device code polling reached"},tokenClaimsRequired:{code:"token_claims_cnf_required_for_signedjwt",desc:"Cannot generate a POP jwt if the token_claims are not populated"},noAuthorizationCodeFromServer:{code:"authorization_code_missing_from_server_response",desc:"Server response does not contain an authorization code to proceed"},noAzureRegionDetected:{code:"no_azure_region_detected",desc:"No azure region was detected and no fallback was made available"},accessTokenEntityNullError:{code:"access_token_entity_null",desc:"Access token entity is null, please check logs and cache to ensure a valid access token is present."},bindingKeyNotRemovedError:{code:"binding_key_not_removed",desc:"Could not remove the credential's binding key from storage."},logoutNotSupported:{code:"end_session_endpoint_not_supported",desc:"Provided authority does not support logout."},keyIdMissing:{code:"key_id_missing",desc:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key."},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},userCanceledError:{code:"user_canceled",desc:"User canceled the flow."},missingTenantIdError:{code:"missing_tenant_id_error",desc:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow."}},m=class extends y{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,m.prototype)}static createClientInfoDecodingError(e){return new m(E.clientInfoDecodingError.code,`${E.clientInfoDecodingError.desc} Failed with error: ${e}`)}static createClientInfoEmptyError(){return new m(E.clientInfoEmptyError.code,`${E.clientInfoEmptyError.desc}`)}static createTokenParsingError(e){return new m(E.tokenParsingError.code,`${E.tokenParsingError.desc} Failed with error: ${e}`)}static createTokenNullOrEmptyError(e){return new m(E.nullOrEmptyToken.code,`${E.nullOrEmptyToken.desc} Raw Token Value: ${e}`)}static createEndpointDiscoveryIncompleteError(e){return new m(E.endpointResolutionError.code,`${E.endpointResolutionError.desc} Detail: ${e}`)}static createNetworkError(e,t){return new m(E.networkError.code,`${E.networkError.desc} | Fetch client threw: ${t} | Attempted to reach: ${e.split("?")[0]}`)}static createUnableToGetOpenidConfigError(e){return new m(E.unableToGetOpenidConfigError.code,`${E.unableToGetOpenidConfigError.desc} Attempted to retrieve endpoints from: ${e}`)}static createHashNotDeserializedError(e){return new m(E.hashNotDeserialized.code,`${E.hashNotDeserialized.desc} Given Object: ${e}`)}static createInvalidStateError(e,t){return new m(E.invalidStateError.code,`${E.invalidStateError.desc} Invalid State: ${e}, Root Err: ${t}`)}static createStateMismatchError(){return new m(E.stateMismatchError.code,E.stateMismatchError.desc)}static createStateNotFoundError(e){return new m(E.stateNotFoundError.code,`${E.stateNotFoundError.desc}:  ${e}`)}static createNonceMismatchError(){return new m(E.nonceMismatchError.code,E.nonceMismatchError.desc)}static createAuthTimeNotFoundError(){return new m(E.authTimeNotFoundError.code,E.authTimeNotFoundError.desc)}static createMaxAgeTranspiredError(){return new m(E.maxAgeTranspiredError.code,E.maxAgeTranspiredError.desc)}static createNonceNotFoundError(e){return new m(E.nonceNotFoundError.code,`${E.nonceNotFoundError.desc}:  ${e}`)}static createMultipleMatchingTokensInCacheError(){return new m(E.multipleMatchingTokens.code,`${E.multipleMatchingTokens.desc}.`)}static createMultipleMatchingAccountsInCacheError(){return new m(E.multipleMatchingAccounts.code,E.multipleMatchingAccounts.desc)}static createMultipleMatchingAppMetadataInCacheError(){return new m(E.multipleMatchingAppMetadata.code,E.multipleMatchingAppMetadata.desc)}static createTokenRequestCannotBeMadeError(){return new m(E.tokenRequestCannotBeMade.code,E.tokenRequestCannotBeMade.desc)}static createAppendEmptyScopeToSetError(e){return new m(E.appendEmptyScopeError.code,`${E.appendEmptyScopeError.desc} Given Scope: ${e}`)}static createRemoveEmptyScopeFromSetError(e){return new m(E.removeEmptyScopeError.code,`${E.removeEmptyScopeError.desc} Given Scope: ${e}`)}static createAppendScopeSetError(e){return new m(E.appendScopeSetError.code,`${E.appendScopeSetError.desc} Detail Error: ${e}`)}static createEmptyInputScopeSetError(){return new m(E.emptyInputScopeSetError.code,`${E.emptyInputScopeSetError.desc}`)}static createDeviceCodeCancelledError(){return new m(E.DeviceCodePollingCancelled.code,`${E.DeviceCodePollingCancelled.desc}`)}static createDeviceCodeExpiredError(){return new m(E.DeviceCodeExpired.code,`${E.DeviceCodeExpired.desc}`)}static createDeviceCodeUnknownError(){return new m(E.DeviceCodeUnknownError.code,`${E.DeviceCodeUnknownError.desc}`)}static createNoAccountInSilentRequestError(){return new m(E.NoAccountInSilentRequest.code,`${E.NoAccountInSilentRequest.desc}`)}static createNullOrUndefinedCacheRecord(){return new m(E.invalidCacheRecord.code,E.invalidCacheRecord.desc)}static createInvalidCacheEnvironmentError(){return new m(E.invalidCacheEnvironment.code,E.invalidCacheEnvironment.desc)}static createNoAccountFoundError(){return new m(E.noAccountFound.code,E.noAccountFound.desc)}static createCachePluginError(){return new m(E.CachePluginError.code,`${E.CachePluginError.desc}`)}static createNoCryptoObjectError(e){return new m(E.noCryptoObj.code,`${E.noCryptoObj.desc}${e}`)}static createInvalidCacheTypeError(){return new m(E.invalidCacheType.code,`${E.invalidCacheType.desc}`)}static createUnexpectedAccountTypeError(){return new m(E.unexpectedAccountType.code,`${E.unexpectedAccountType.desc}`)}static createUnexpectedCredentialTypeError(){return new m(E.unexpectedCredentialType.code,`${E.unexpectedCredentialType.desc}`)}static createInvalidAssertionError(){return new m(E.invalidAssertion.code,`${E.invalidAssertion.desc}`)}static createInvalidCredentialError(){return new m(E.invalidClientCredential.code,`${E.invalidClientCredential.desc}`)}static createRefreshRequiredError(){return new m(E.tokenRefreshRequired.code,E.tokenRefreshRequired.desc)}static createUserTimeoutReachedError(){return new m(E.userTimeoutReached.code,E.userTimeoutReached.desc)}static createTokenClaimsRequiredError(){return new m(E.tokenClaimsRequired.code,E.tokenClaimsRequired.desc)}static createNoAuthCodeInServerResponseError(){return new m(E.noAuthorizationCodeFromServer.code,E.noAuthorizationCodeFromServer.desc)}static createBindingKeyNotRemovedError(){return new m(E.bindingKeyNotRemovedError.code,E.bindingKeyNotRemovedError.desc)}static createLogoutNotSupportedError(){return new m(E.logoutNotSupported.code,E.logoutNotSupported.desc)}static createKeyIdMissingError(){return new m(E.keyIdMissing.code,E.keyIdMissing.desc)}static createNoNetworkConnectivityError(){return new m(E.noNetworkConnectivity.code,E.noNetworkConnectivity.desc)}static createUserCanceledError(){return new m(E.userCanceledError.code,E.userCanceledError.desc)}static createMissingTenantIdError(){return new y(E.missingTenantIdError.code,E.missingTenantIdError.desc)}};var g=class{static decodeAuthToken(e){if(g.isEmpty(e))throw m.createTokenNullOrEmptyError(e);let r=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!r||r.length<4)throw m.createTokenParsingError(`Given token is malformed: ${JSON.stringify(e)}`);return{header:r[1],JWSPayload:r[2],JWSSig:r[3]}}static isEmpty(e){return typeof e>"u"||!e||e.length===0}static isEmptyObj(e){if(e&&!g.isEmpty(e))try{let t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},r=e.split("&"),o=n=>decodeURIComponent(n.replace(/\+/g," "));return r.forEach(n=>{if(n.trim()){let[i,s]=n.split(/=(.+)/g,2);i&&s&&(t[o(i)]=o(s))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!g.isEmpty(t))}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}};var U=(()=>(U=U||{},U[U.Error=0]="Error",U[U.Warning=1]="Warning",U[U.Info=2]="Info",U[U.Verbose=3]="Verbose",U[U.Trace=4]="Trace",U))(),Re=class{constructor(e,t,r){this.level=U.Info;let o=()=>{},n=e||Re.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||o,this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level=typeof n.logLevel=="number"?n.logLevel:U.Info,this.correlationId=n.correlationId||a.EMPTY_STRING,this.packageName=t||a.EMPTY_STRING,this.packageVersion=r||a.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:U.Info}}clone(e,t,r){return new Re({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let r=new Date().toUTCString(),o;g.isEmpty(t.correlationId)?g.isEmpty(this.correlationId)?o=`[${r}]`:o=`[${r}] : [${this.correlationId}]`:o=`[${r}] : [${t.correlationId}]`;let n=`${o} : ${this.packageName}@${this.packageVersion} : ${U[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,n,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:U.Error,containsPii:!1,correlationId:t||a.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:U.Error,containsPii:!0,correlationId:t||a.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:U.Warning,containsPii:!1,correlationId:t||a.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:U.Warning,containsPii:!0,correlationId:t||a.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:U.Info,containsPii:!1,correlationId:t||a.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:U.Info,containsPii:!0,correlationId:t||a.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:U.Verbose,containsPii:!1,correlationId:t||a.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:U.Verbose,containsPii:!0,correlationId:t||a.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:U.Trace,containsPii:!1,correlationId:t||a.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:U.Trace,containsPii:!0,correlationId:t||a.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};var Ft="@azure/msal-common",ht="14.0.0-beta.1";var Je={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};var k={redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},claimsRequestParsingError:{code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},authorityUriInsecure:{code:"authority_uri_insecure",desc:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},urlParseError:{code:"url_parse_error",desc:"URL could not be parsed into appropriate segments."},urlEmptyError:{code:"empty_url_error",desc:"URL was empty or null."},emptyScopesError:{code:"empty_input_scopes_error",desc:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token."},nonArrayScopesError:{code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},clientIdSingleScopeError:{code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},invalidPrompt:{code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest"},invalidClaimsRequest:{code:"invalid_claims",desc:"Given claims parameter must be a stringified JSON object."},tokenRequestEmptyError:{code:"token_request_empty",desc:"Token request was empty and not found in cache."},logoutRequestEmptyError:{code:"logout_request_empty",desc:"The logout request was null or undefined."},invalidCodeChallengeMethod:{code:"invalid_code_challenge_method",desc:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".'},invalidCodeChallengeParams:{code:"pkce_params_missing",desc:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request"},invalidCloudDiscoveryMetadata:{code:"invalid_cloud_discovery_metadata",desc:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields"},invalidAuthorityMetadata:{code:"invalid_authority_metadata",desc:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields."},untrustedAuthority:{code:"untrusted_authority",desc:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter."},invalidAzureCloudInstance:{code:"invalid_azure_cloud_instance",desc:"Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values"},missingSshJwk:{code:"missing_ssh_jwk",desc:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme."},missingSshKid:{code:"missing_ssh_kid",desc:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme."},missingNonceAuthenticationHeader:{code:"missing_nonce_authentication_header",desc:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce."},invalidAuthenticationHeader:{code:"invalid_authentication_header",desc:"Invalid authentication header provided"},authorityMismatch:{code:"authority_mismatch",desc:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."}},S=class extends m{constructor(e,t){super(e,t),this.name="ClientConfigurationError",Object.setPrototypeOf(this,S.prototype)}static createRedirectUriEmptyError(){return new S(k.redirectUriNotSet.code,k.redirectUriNotSet.desc)}static createPostLogoutRedirectUriEmptyError(){return new S(k.postLogoutUriNotSet.code,k.postLogoutUriNotSet.desc)}static createClaimsRequestParsingError(e){return new S(k.claimsRequestParsingError.code,`${k.claimsRequestParsingError.desc} Given value: ${e}`)}static createInsecureAuthorityUriError(e){return new S(k.authorityUriInsecure.code,`${k.authorityUriInsecure.desc} Given URI: ${e}`)}static createUrlParseError(e){return new S(k.urlParseError.code,`${k.urlParseError.desc} Given Error: ${e}`)}static createUrlEmptyError(){return new S(k.urlEmptyError.code,k.urlEmptyError.desc)}static createEmptyScopesArrayError(){return new S(k.emptyScopesError.code,`${k.emptyScopesError.desc}`)}static createClientIdSingleScopeError(e){return new S(k.clientIdSingleScopeError.code,`${k.clientIdSingleScopeError.desc} Given Scopes: ${e}`)}static createInvalidPromptError(e){return new S(k.invalidPrompt.code,`${k.invalidPrompt.desc} Given value: ${e}`)}static createInvalidClaimsRequestError(){return new S(k.invalidClaimsRequest.code,k.invalidClaimsRequest.desc)}static createEmptyLogoutRequestError(){return new S(k.logoutRequestEmptyError.code,k.logoutRequestEmptyError.desc)}static createEmptyTokenRequestError(){return new S(k.tokenRequestEmptyError.code,k.tokenRequestEmptyError.desc)}static createInvalidCodeChallengeMethodError(){return new S(k.invalidCodeChallengeMethod.code,k.invalidCodeChallengeMethod.desc)}static createInvalidCodeChallengeParamsError(){return new S(k.invalidCodeChallengeParams.code,k.invalidCodeChallengeParams.desc)}static createInvalidCloudDiscoveryMetadataError(){return new S(k.invalidCloudDiscoveryMetadata.code,k.invalidCloudDiscoveryMetadata.desc)}static createInvalidAuthorityMetadataError(){return new S(k.invalidAuthorityMetadata.code,k.invalidAuthorityMetadata.desc)}static createUntrustedAuthorityError(){return new S(k.untrustedAuthority.code,k.untrustedAuthority.desc)}static createInvalidAzureCloudInstanceError(){return new S(k.invalidAzureCloudInstance.code,k.invalidAzureCloudInstance.desc)}static createMissingSshJwkError(){return new S(k.missingSshJwk.code,k.missingSshJwk.desc)}static createMissingSshKidError(){return new S(k.missingSshKid.code,k.missingSshKid.desc)}static createMissingNonceAuthenticationHeadersError(){return new S(k.missingNonceAuthenticationHeader.code,k.missingNonceAuthenticationHeader.desc)}static createInvalidAuthenticationHeaderError(e,t){return new S(k.invalidAuthenticationHeader.code,`${k.invalidAuthenticationHeader.desc}. Invalid header: ${e}. Details: ${t}`)}static createAuthorityMismatchError(){return new S(k.authorityMismatch.code,k.authorityMismatch.desc)}};var L=class{constructor(e){let t=e?g.trimArrayEntries([...e]):[],r=t?g.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(o=>this.scopes.add(o))}static fromString(e){let r=(e||a.EMPTY_STRING).split(" ");return new L(r)}static createSearchScopes(e){let t=new L(e);return t.containsOnlyOIDCScopes()?t.removeScope(a.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw S.createEmptyScopesArrayError()}containsScope(e){let t=this.printScopesLowerCase().split(" "),r=new L(t);return g.isEmpty(e)?!1:r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return pr.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){g.isEmpty(e)||this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch(t){throw m.createAppendScopeSetError(t)}}removeScope(e){if(g.isEmpty(e))throw m.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim())}removeOIDCScopes(){pr.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw m.createEmptyInputScopeSetError();let t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw m.createEmptyInputScopeSetError();e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),r=e.getScopeCount(),o=this.getScopeCount();return t.size<o+r}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):a.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}};function Xe(p,e){if(g.isEmpty(p))throw m.createClientInfoEmptyError();try{let t=e.base64Decode(p);return JSON.parse(t)}catch(t){throw m.createClientInfoDecodingError(t.message)}}function Oe(p){if(g.isEmpty(p))throw m.createClientInfoDecodingError("Home account ID was empty.");let e=p.split(q.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?a.EMPTY_STRING:e[1]}}var re={Default:0,Adfs:1,Dsts:2,Ciam:3};var D=class{generateAccountId(){return[this.homeAccountId,this.environment].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return D.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}generateType(){switch(this.authorityType){case Pe.ADFS_ACCOUNT_TYPE:return ke.ADFS;case Pe.MSAV1_ACCOUNT_TYPE:return ke.MSA;case Pe.MSSTS_ACCOUNT_TYPE:return ke.MSSTS;case Pe.GENERIC_ACCOUNT_TYPE:return ke.GENERIC;default:throw m.createUnexpectedAccountTypeError()}}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,idTokenClaims:this.idTokenClaims,nativeAccountId:this.nativeAccountId}}static generateAccountCacheKey(e){return[e.homeAccountId,e.environment||a.EMPTY_STRING,e.tenantId||a.EMPTY_STRING].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r,o,n,i,s,c){let l=new D;l.authorityType=Pe.MSSTS_ACCOUNT_TYPE,l.clientInfo=e,l.homeAccountId=t,l.nativeAccountId=c;let f=s||o&&o.getPreferredCache();if(!f)throw m.createInvalidCacheEnvironmentError();if(l.environment=f,l.realm=r?.claims?.tid||a.EMPTY_STRING,r){l.idTokenClaims=r.claims,l.localAccountId=r?.claims?.oid||r?.claims?.sub||a.EMPTY_STRING;let _=r?.claims?.preferred_username,N=r?.claims?.emails?r.claims.emails[0]:null;l.username=_||N||a.EMPTY_STRING,l.name=r?.claims?.name}return l.cloudGraphHostName=n,l.msGraphHost=i,l}static createGenericAccount(e,t,r,o,n,i){let s=new D;s.authorityType=r&&r.authorityType===re.Adfs?Pe.ADFS_ACCOUNT_TYPE:Pe.GENERIC_ACCOUNT_TYPE,s.homeAccountId=e,s.realm=a.EMPTY_STRING;let c=i||r&&r.getPreferredCache();if(!c)throw m.createInvalidCacheEnvironmentError();return t&&(s.localAccountId=t?.claims?.oid||t?.claims?.sub||a.EMPTY_STRING,s.username=t?.claims?.upn||a.EMPTY_STRING,s.name=t?.claims?.name||a.EMPTY_STRING,s.idTokenClaims=t?.claims),s.environment=c,s.cloudGraphHostName=o,s.msGraphHost=n,s}static generateHomeAccountId(e,t,r,o,n){let i=n?.claims?.sub?n.claims.sub:a.EMPTY_STRING;if(t===re.Adfs||t===re.Dsts)return i;if(e)try{let s=Xe(e,o);if(!g.isEmpty(s.uid)&&!g.isEmpty(s.utid))return`${s.uid}${q.CLIENT_INFO_SEPARATOR}${s.utid}`}catch{}return r.verbose("No client info in response"),i}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let o=!0;if(r){let n=e.idTokenClaims||{},i=t.idTokenClaims||{};o=n.iat===i.iat&&n.nonce===i.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&o}};var G=class{constructor(e,t){if(g.isEmpty(e))throw m.createTokenNullOrEmptyError(e);this.rawToken=e,this.claims=G.extractTokenClaims(e,t)}static extractTokenClaims(e,t){let r=g.decodeAuthToken(e);try{let o=r.JWSPayload,n=t.base64Decode(o);return JSON.parse(n)}catch(o){throw m.createTokenParsingError(o)}}static checkMaxAge(e,t){if(t===0||Date.now()-3e5>e+t)throw m.createMaxAgeTranspiredError()}};var X=class{constructor(e,t,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Ft,ht)}getAllAccounts(){let e=this.getAccountKeys();if(e.length<1)return[];let t=e.reduce((r,o)=>{let n=this.getAccount(o);return n&&r.push(n),r},[]);return t.length<1?[]:t.map(o=>this.getAccountInfoFromEntity(o))}getAccountInfoFilteredBy(e){let t=this.getAccountsFilteredBy(e);return t.length>0?this.getAccountInfoFromEntity(t[0]):null}getAccountInfoFromEntity(e){let t=e.getAccountInfo(),r=this.getIdToken(t);return r&&(t.idToken=r.secret,t.idTokenClaims=new G(r.secret,this.cryptoImpl).claims),t}saveCacheRecord(e){return d(this,null,function*(){if(!e)throw m.createNullOrUndefinedCacheRecord();e.account&&this.setAccount(e.account),e.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken&&(yield this.saveAccessToken(e.accessToken)),e.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)})}saveAccessToken(e){return d(this,null,function*(){let t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),o=L.fromString(e.target),n=[];r.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,t,!1))return;let s=this.getAccessTokenCredential(i);s&&this.credentialMatchesFilter(s,t)&&L.fromString(s.target).intersectingScopeSets(o)&&n.push(this.removeAccessToken(i))}),yield Promise.all(n),this.setAccessTokenCredential(e)})}getAccountsFilteredBy(e){let t=this.getAccountKeys(),r=[];return t.forEach(o=>{if(!this.isAccountKey(o,e.homeAccountId,e.realm))return;let n=this.getAccount(o);n&&(e.homeAccountId&&!this.matchHomeAccountId(n,e.homeAccountId)||e.localAccountId&&!this.matchLocalAccountId(n,e.localAccountId)||e.username&&!this.matchUsername(n,e.username)||e.environment&&!this.matchEnvironment(n,e.environment)||e.realm&&!this.matchRealm(n,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(n,e.nativeAccountId)||r.push(n))}),r}isAccountKey(e,t,r){return!(e.split(q.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(q.CACHE_KEY_SEPARATOR).length<6)return!1;let t=e.toLowerCase();if(t.indexOf(A.ID_TOKEN.toLowerCase())===-1&&t.indexOf(A.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(A.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(A.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(A.REFRESH_TOKEN.toLowerCase())>-1){let r=`${A.REFRESH_TOKEN}${q.CACHE_KEY_SEPARATOR}${this.clientId}${q.CACHE_KEY_SEPARATOR}`,o=`${A.REFRESH_TOKEN}${q.CACHE_KEY_SEPARATOR}${qe}${q.CACHE_KEY_SEPARATOR}`;if(t.indexOf(r.toLowerCase())===-1&&t.indexOf(o.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===A.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===P.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)}getAppMetadataFilteredByInternal(e,t){let r=this.getKeys(),o={};return r.forEach(n=>{if(!this.isAppMetadata(n))return;let i=this.getAppMetadata(n);i&&(e&&!this.matchEnvironment(i,e)||t&&!this.matchClientId(i,t)||(o[n]=i))}),o}getAuthorityMetadataByAlias(e){let t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(o=>{if(!this.isAuthorityMetadata(o)||o.indexOf(this.clientId)===-1)return;let n=this.getAuthorityMetadata(o);n&&n.aliases.indexOf(e)!==-1&&(r=n)}),r}removeAllAccounts(){return d(this,null,function*(){let e=this.getAccountKeys(),t=[];e.forEach(r=>{t.push(this.removeAccount(r))}),yield Promise.all(t)})}removeAccount(e){return d(this,null,function*(){let t=this.getAccount(e);t&&(yield this.removeAccountContext(t),this.removeItem(e))})}removeAccountContext(e){return d(this,null,function*(){let t=this.getTokenKeys(),r=e.generateAccountId(),o=[];t.idToken.forEach(n=>{n.indexOf(r)===0&&this.removeIdToken(n)}),t.accessToken.forEach(n=>{n.indexOf(r)===0&&o.push(this.removeAccessToken(n))}),t.refreshToken.forEach(n=>{n.indexOf(r)===0&&this.removeRefreshToken(n)}),yield Promise.all(o)})}removeAccessToken(e){return d(this,null,function*(){let t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===A.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===P.POP){let o=t.keyId;if(o)try{yield this.cryptoImpl.removeTokenBindingKey(o)}catch{throw m.createBindingKeyNotRemovedError()}}return this.removeItem(e)}})}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readCacheRecord(e,t,r){let o=this.getTokenKeys(),n=this.readAccountFromCache(e),i=this.getIdToken(e,o),s=this.getAccessToken(e,t,o),c=this.getRefreshToken(e,!1,o),l=this.readAppMetadataFromCache(r);return n&&i&&(n.idTokenClaims=new G(i.secret,this.cryptoImpl).claims),{account:n,idToken:i,accessToken:s,refreshToken:c,appMetadata:l}}readAccountFromCache(e){let t=D.generateAccountCacheKey(e);return this.getAccount(t)}getIdToken(e,t){this.commonLogger.trace("CacheManager - getIdToken called");let r={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:A.ID_TOKEN,clientId:this.clientId,realm:e.tenantId},o=this.getIdTokensByFilter(r,t),n=o.length;if(n<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(n>1)throw m.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getIdToken - Returning id token"),o[0]}getIdTokensByFilter(e,t){let r=t&&t.idToken||this.getTokenKeys().idToken,o=[];return r.forEach(n=>{if(!this.idTokenKeyMatchesFilter(n,T({clientId:this.clientId},e)))return;let i=this.getIdTokenCredential(n);i&&this.credentialMatchesFilter(i,e)&&o.push(i)}),o}idTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r){this.commonLogger.trace("CacheManager - getAccessToken called");let o=L.createSearchScopes(t.scopes),n=t.authenticationScheme||P.BEARER,i=n&&n.toLowerCase()!==P.BEARER.toLowerCase()?A.ACCESS_TOKEN_WITH_AUTH_SCHEME:A.ACCESS_TOKEN,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:i,clientId:this.clientId,realm:e.tenantId,target:o,tokenType:n,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},c=r&&r.accessToken||this.getTokenKeys().accessToken,l=[];c.forEach(_=>{if(this.accessTokenKeyMatchesFilter(_,s,!0)){let N=this.getAccessTokenCredential(_);N&&this.credentialMatchesFilter(N,s)&&l.push(N)}});let f=l.length;if(f<1)return this.commonLogger.info("CacheManager:getAccessToken - No token found"),null;if(f>1)throw m.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),l[0]}accessTokenKeyMatchesFilter(e,t,r){let o=e.toLowerCase();if(t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&o.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&o.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){let n=t.target.asArray();for(let i=0;i<n.length;i++){if(r&&!o.includes(n[i].toLowerCase()))return!1;if(!r&&o.includes(n[i].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){let t=this.getTokenKeys(),r=[];return t.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;let n=this.getAccessTokenCredential(o);n&&this.credentialMatchesFilter(n,e)&&r.push(n)}),r}getRefreshToken(e,t,r){this.commonLogger.trace("CacheManager - getRefreshToken called");let o=t?qe:void 0,n={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:A.REFRESH_TOKEN,clientId:this.clientId,familyId:o},i=r&&r.refreshToken||this.getTokenKeys().refreshToken,s=[];return i.forEach(l=>{if(this.refreshTokenKeyMatchesFilter(l,n)){let f=this.getRefreshTokenCredential(l);f&&this.credentialMatchesFilter(f,n)&&s.push(f)}}),s.length<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),s[0])}refreshTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){let t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),o=Object.keys(r).map(i=>r[i]),n=o.length;if(n<1)return null;if(n>1)throw m.createMultipleMatchingAppMetadataInCacheError();return o[0]}isAppMetadataFOCI(e){let t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===qe)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountId(e,t){return typeof e.localAccountId=="string"&&t===e.localAccountId}matchUsername(e,t){return typeof e.username=="string"&&t.toLowerCase()===e.username.toLowerCase()}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){let r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return!!(e.realm&&t===e.realm)}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchTarget(e,t){return e.credentialType!==A.ACCESS_TOKEN&&e.credentialType!==A.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:L.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(At)!==-1}isAuthorityMetadata(e){return e.indexOf(We.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${We.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(let r in t)e[r]=t[r];return e}},Rt=class extends X{setAccount(){let e="Storage interface - setAccount() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAccount(){let e="Storage interface - getAccount() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setIdTokenCredential(){let e="Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getIdTokenCredential(){let e="Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setAccessTokenCredential(){let e="Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAccessTokenCredential(){let e="Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setRefreshTokenCredential(){let e="Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getRefreshTokenCredential(){let e="Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setAppMetadata(){let e="Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAppMetadata(){let e="Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setServerTelemetry(){let e="Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getServerTelemetry(){let e="Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setAuthorityMetadata(){let e="Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAuthorityMetadata(){let e="Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAuthorityMetadataKeys(){let e="Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}setThrottlingCache(){let e="Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getThrottlingCache(){let e="Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}removeItem(){let e="Storage interface - removeItem() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}containsKey(){let e="Storage interface - containsKey() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getKeys(){let e="Storage interface - getKeys() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getAccountKeys(){let e="Storage interface - getAccountKeys() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}getTokenKeys(){let e="Storage interface - getTokenKeys() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}clear(){return d(this,null,function*(){let e="Storage interface - clear() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)})}updateCredentialCacheKey(){let e="Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.";throw y.createUnexpectedError(e)}};var Lr=300,qt={tokenRenewalOffsetSeconds:Lr,preventCorsPreflight:!1},Kr={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:U.Info,correlationId:a.EMPTY_STRING},Fr={claimsBasedCachingEnabled:!1},qr={sendGetRequestAsync(){return d(this,null,function*(){let p="Network interface - sendGetRequestAsync() has not been implemented";throw y.createUnexpectedError(p)})},sendPostRequestAsync(){return d(this,null,function*(){let p="Network interface - sendPostRequestAsync() has not been implemented";throw y.createUnexpectedError(p)})}},Br={sku:a.SKU,version:ht,cpu:a.EMPTY_STRING,os:a.EMPTY_STRING},Gr={clientSecret:a.EMPTY_STRING,clientAssertion:void 0},$r={azureCloudInstance:Je.None,tenant:`${a.DEFAULT_COMMON_TENANT}`},zr={application:{appName:"",appVersion:""}};function Ar({authOptions:p,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:o,networkInterface:n,cryptoInterface:i,clientCredentials:s,libraryInfo:c,telemetry:l,serverTelemetryManager:f,persistencePlugin:_,serializableCache:N}){let F=T(T({},Kr),t);return{authOptions:Yr(p),systemOptions:T(T({},qt),e),loggerOptions:F,cacheOptions:T(T({},Fr),r),storageInterface:o||new Rt(p.clientId,Ge,new Re(F)),networkInterface:n||qr,cryptoInterface:i||Ge,clientCredentials:s||Gr,libraryInfo:T(T({},Br),c),telemetry:T(T({},zr),l),serverTelemetryManager:f||null,persistencePlugin:_||null,serializableCache:N||null}}function Yr(p){return T({clientCapabilities:[],azureCloudOptions:$r,skipAuthorityMetadataCache:!1},p)}var ee=class extends y{constructor(e,t,r){super(e,t,r),this.name="ServerError",Object.setPrototypeOf(this,ee.prototype)}};var ne=class{static generateThrottlingStorageKey(e){return`${Me.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){let r=ne.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r);if(o){if(o.throttleTime<Date.now()){e.removeItem(r);return}throw new ee(o.errorCodes?.join(" ")||a.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,r){if(ne.checkResponseStatus(r)||ne.checkResponseForRetryAfter(r)){let o={throttleTime:ne.calculateThrottleTime(parseInt(r.headers[te.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(ne.generateThrottlingStorageKey(t),o)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(te.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){let t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||Me.DEFAULT_THROTTLE_TIME_SECONDS),r+Me.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,o){let n={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:o,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},i=this.generateThrottlingStorageKey(n);e.removeItem(i)}};var Bt=class{constructor(e,t){this.networkClient=e,this.cacheManager=t}sendPostRequest(e,t,r){return d(this,null,function*(){ne.preProcess(this.cacheManager,e);let o;try{o=yield this.networkClient.sendPostRequestAsync(t,r)}catch(n){throw n instanceof y?n:m.createNetworkError(t,n)}return ne.postProcess(this.cacheManager,e,o),o})}};var ie={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};var we=class{static validateRedirectUri(e){if(g.isEmpty(e))throw S.createRedirectUriEmptyError()}static validatePrompt(e){let t=[];for(let r in $)t.push($[r]);if(t.indexOf(e)<0)throw S.createInvalidPromptError(e)}static validateClaims(e){try{JSON.parse(e)}catch{throw S.createInvalidClaimsRequestError()}}static validateCodeChallengeParams(e,t){if(g.isEmpty(e)||g.isEmpty(t))throw S.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([Dt.PLAIN,Dt.S256].indexOf(e)<0)throw S.createInvalidCodeChallengeMethodError()}static sanitizeEQParams(e,t){return e?(t.forEach((r,o)=>{e[o]&&delete e[o]}),Object.fromEntries(Object.entries(e).filter(r=>r[1]!==""))):{}}};var be=class{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(R.RESPONSE_TYPE,encodeURIComponent(a.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(R.RESPONSE_TYPE,encodeURIComponent(`${a.TOKEN_RESPONSE_TYPE} ${a.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(R.RESPONSE_MODE,encodeURIComponent(e||St.QUERY))}addNativeBroker(){this.parameters.set(R.NATIVE_BROKER,encodeURIComponent("1"))}addScopes(e,t=!0){let r=t?[...e||[],...ve]:e||[],o=new L(r);this.parameters.set(R.SCOPE,encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(R.CLIENT_ID,encodeURIComponent(e))}addRedirectUri(e){we.validateRedirectUri(e),this.parameters.set(R.REDIRECT_URI,encodeURIComponent(e))}addPostLogoutRedirectUri(e){we.validateRedirectUri(e),this.parameters.set(R.POST_LOGOUT_URI,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(R.ID_TOKEN_HINT,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(_t.DOMAIN_HINT,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(_t.LOGIN_HINT,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(te.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(te.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(_t.SID,encodeURIComponent(e))}addClaims(e,t){let r=this.addClientCapabilitiesToClaims(e,t);we.validateClaims(r),this.parameters.set(R.CLAIMS,encodeURIComponent(r))}addCorrelationId(e){this.parameters.set(R.CLIENT_REQUEST_ID,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(R.X_CLIENT_SKU,e.sku),this.parameters.set(R.X_CLIENT_VER,e.version),e.os&&this.parameters.set(R.X_CLIENT_OS,e.os),e.cpu&&this.parameters.set(R.X_CLIENT_CPU,e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set(R.X_APP_NAME,e.appName),e?.appVersion&&this.parameters.set(R.X_APP_VER,e.appVersion)}addPrompt(e){we.validatePrompt(e),this.parameters.set(`${R.PROMPT}`,encodeURIComponent(e))}addState(e){g.isEmpty(e)||this.parameters.set(R.STATE,encodeURIComponent(e))}addNonce(e){this.parameters.set(R.NONCE,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(we.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(R.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(R.CODE_CHALLENGE_METHOD,encodeURIComponent(t));else throw S.createInvalidCodeChallengeParamsError()}addAuthorizationCode(e){this.parameters.set(R.CODE,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(R.DEVICE_CODE,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(R.REFRESH_TOKEN,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(R.CODE_VERIFIER,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(R.CLIENT_SECRET,encodeURIComponent(e))}addClientAssertion(e){g.isEmpty(e)||this.parameters.set(R.CLIENT_ASSERTION,encodeURIComponent(e))}addClientAssertionType(e){g.isEmpty(e)||this.parameters.set(R.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(R.OBO_ASSERTION,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(R.REQUESTED_TOKEN_USE,encodeURIComponent(e))}addGrantType(e){this.parameters.set(R.GRANT_TYPE,encodeURIComponent(e))}addClientInfo(){this.parameters.set(Sr,"1")}addExtraQueryParameters(e){let t=we.sanitizeEQParams(e,this.parameters);Object.keys(t).forEach(r=>{this.parameters.set(r,e[r])})}addClientCapabilitiesToClaims(e,t){let r;if(!e)r={};else try{r=JSON.parse(e)}catch{throw S.createInvalidClaimsRequestError()}return t&&t.length>0&&(r.hasOwnProperty(lt.ACCESS_TOKEN)||(r[lt.ACCESS_TOKEN]={}),r[lt.ACCESS_TOKEN][lt.XMS_CC]={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set(Lt.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(Lt.password,encodeURIComponent(e))}addPopToken(e){g.isEmpty(e)||(this.parameters.set(R.TOKEN_TYPE,P.POP),this.parameters.set(R.REQ_CNF,encodeURIComponent(e)))}addSshJwk(e){g.isEmpty(e)||(this.parameters.set(R.TOKEN_TYPE,P.SSH),this.parameters.set(R.REQ_CNF,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(R.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(R.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(R.X_MS_LIB_CAPABILITY,Me.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(R.LOGOUT_HINT,encodeURIComponent(e))}createQueryString(){let e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),e.join("&")}};var $e=class{constructor(e,t){this.config=Ar(e),this.logger=new Re(this.config.loggerOptions,Ft,ht),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new Bt(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){let t={};if(t[te.CONTENT_TYPE]=a.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case ie.HOME_ACCOUNT_ID:try{let r=Oe(e.credential);t[te.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case ie.UPN:t[te.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}executePostToTokenEndpoint(e,t,r,o){return d(this,null,function*(){let n=yield this.networkManager.sendPostRequest(o,e,{body:t,headers:r});return this.config.serverTelemetryManager&&n.status<500&&n.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),n})}updateAuthority(e){if(!e.discoveryComplete())throw m.createEndpointDiscoveryIncompleteError("Updated authority has not completed endpoint discovery.");this.authority=e}createTokenQueryParameters(e){let t=new be;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}};var ge=class{generateAccountId(){return ge.generateAccountIdForCacheKey(this.homeAccountId,this.environment)}generateCredentialId(){return ge.generateCredentialIdForCacheKey(this.credentialType,this.clientId,this.realm,this.familyId)}generateTarget(){return ge.generateTargetForCacheKey(this.target)}generateCredentialKey(){return ge.generateCredentialCacheKey(this.homeAccountId,this.environment,this.credentialType,this.clientId,this.realm,this.target,this.familyId,this.tokenType,this.requestedClaimsHash)}generateType(){switch(this.credentialType){case A.ID_TOKEN:return ke.ID_TOKEN;case A.ACCESS_TOKEN:case A.ACCESS_TOKEN_WITH_AUTH_SCHEME:return ke.ACCESS_TOKEN;case A.REFRESH_TOKEN:return ke.REFRESH_TOKEN;default:throw m.createUnexpectedCredentialTypeError()}}static generateCredentialCacheKey(e,t,r,o,n,i,s,c,l){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(r,o,n,s),this.generateTargetForCacheKey(i),this.generateClaimsHashForCacheKey(l),this.generateSchemeForCacheKey(c)].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}static generateAccountIdForCacheKey(e,t){return[e,t].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}static generateCredentialIdForCacheKey(e,t,r,o){let n=e===A.REFRESH_TOKEN&&o||t;return[e,n,r||a.EMPTY_STRING].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}static generateTargetForCacheKey(e){return(e||a.EMPTY_STRING).toLowerCase()}static generateClaimsHashForCacheKey(e){return(e||a.EMPTY_STRING).toLowerCase()}static generateSchemeForCacheKey(e){return e&&e.toLowerCase()!==P.BEARER.toLowerCase()?e.toLowerCase():a.EMPTY_STRING}};var se=class extends ge{static createIdTokenEntity(e,t,r,o,n){let i=new se;return i.credentialType=A.ID_TOKEN,i.homeAccountId=e,i.environment=t,i.clientId=o,i.secret=r,i.realm=n,i}static isIdTokenEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===A.ID_TOKEN:!1}};var K=class{static nowSeconds(){return Math.round(new Date().getTime()/1e3)}static isTokenExpired(e,t){let r=Number(e)||0;return K.nowSeconds()+t>r}static wasClockTurnedBack(e){return Number(e)>K.nowSeconds()}static delay(e,t){return new Promise(r=>setTimeout(()=>r(t),e))}};var ae=class extends ge{static createAccessTokenEntity(e,t,r,o,n,i,s,c,l,f,_,N,F,V,_e){let H=new ae;H.homeAccountId=e,H.credentialType=A.ACCESS_TOKEN,H.secret=r;let pe=K.nowSeconds();if(H.cachedAt=pe.toString(),H.expiresOn=s.toString(),H.extendedExpiresOn=c.toString(),f&&(H.refreshOn=f.toString()),H.environment=t,H.clientId=o,H.realm=n,H.target=i,H.userAssertionHash=N,H.tokenType=g.isEmpty(_)?P.BEARER:_,V&&(H.requestedClaims=V,H.requestedClaimsHash=_e),H.tokenType?.toLowerCase()!==P.BEARER.toLowerCase())switch(H.credentialType=A.ACCESS_TOKEN_WITH_AUTH_SCHEME,H.tokenType){case P.POP:let Ke=G.extractTokenClaims(r,l);if(!Ke?.cnf?.kid)throw m.createTokenClaimsRequiredError();H.keyId=Ke.cnf.kid;break;case P.SSH:H.keyId=F}return H}static isAccessTokenEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.hasOwnProperty("target")&&(e.credentialType===A.ACCESS_TOKEN||e.credentialType===A.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}};var he=class extends ge{static createRefreshTokenEntity(e,t,r,o,n,i){let s=new he;return s.clientId=o,s.credentialType=A.REFRESH_TOKEN,s.environment=t,s.homeAccountId=e,s.secret=r,s.userAssertionHash=i,n&&(s.familyId=n),s}static isRefreshTokenEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===A.REFRESH_TOKEN:!1}};var vr=["interaction_required","consent_required","login_required"],Qr=["message_only","additional_action","basic_action","user_password_expired","consent_required"],Ze={noTokensFoundError:{code:"no_tokens_found",desc:"No refresh token found in the cache. Please sign-in."},native_account_unavailable:{code:"native_account_unavailable",desc:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API."}},z=class extends y{constructor(e,t,r,o,n,i,s){super(e,t,r),Object.setPrototypeOf(this,z.prototype),this.timestamp=o||a.EMPTY_STRING,this.traceId=n||a.EMPTY_STRING,this.correlationId=i||a.EMPTY_STRING,this.claims=s||a.EMPTY_STRING,this.name="InteractionRequiredAuthError"}static isInteractionRequiredError(e,t,r){let o=!!e&&vr.indexOf(e)>-1,n=!!r&&Qr.indexOf(r)>-1,i=!!t&&vr.some(s=>t.indexOf(s)>-1);return o||i||n}static createNoTokensFoundError(){return new z(Ze.noTokensFoundError.code,Ze.noTokensFoundError.desc)}static createNativeAccountUnavailableError(){return new z(Ze.native_account_unavailable.code,Ze.native_account_unavailable.desc)}};var et=class{constructor(e,t,r,o,n){this.account=e||null,this.idToken=t||null,this.accessToken=r||null,this.refreshToken=o||null,this.appMetadata=n||null}};var Q=class{static setRequestState(e,t,r){let o=Q.generateLibraryState(e,r);return g.isEmpty(t)?o:`${o}${a.RESOURCE_DELIM}${t}`}static generateLibraryState(e,t){if(!e)throw m.createNoCryptoObjectError("generateLibraryState");let r={id:e.createNewGuid()};t&&(r.meta=t);let o=JSON.stringify(r);return e.base64Encode(o)}static parseRequestState(e,t){if(!e)throw m.createNoCryptoObjectError("parseRequestState");if(g.isEmpty(t))throw m.createInvalidStateError(t,"Null, undefined or empty state");try{let r=t.split(a.RESOURCE_DELIM),o=r[0],n=r.length>1?r.slice(1).join(a.RESOURCE_DELIM):a.EMPTY_STRING,i=e.base64Decode(o),s=JSON.parse(i);return{userRequestState:g.isEmpty(n)?a.EMPTY_STRING:n,libraryState:s}}catch(r){throw m.createInvalidStateError(t,r)}}};var w=class{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,g.isEmpty(this._urlString))throw S.createUrlEmptyError();g.isEmpty(this.getHash())&&(this._urlString=w.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return g.endsWith(t,"?")?t=t.slice(0,-1):g.endsWith(t,"?/")&&(t=t.slice(0,-2)),g.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(t){throw S.createUrlParseError(t)}if(!e.HostNameAndPort||!e.PathSegments)throw S.createUrlParseError(`Given url string: ${this.urlString}`);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw S.createInsecureAuthorityUriError(this.urlString)}static appendQueryString(e,t){return g.isEmpty(t)?e:e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`}static removeHashFromUrl(e){return w.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Fe.COMMON||r[0]===Fe.ORGANIZATIONS)&&(r[0]=e),w.constructAuthorityUriFromObject(t)}getHash(){return w.parseHash(this.urlString)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw S.createUrlParseError(`Given url string: ${this.urlString}`);let r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},o=r.AbsolutePath.split("/");return o=o.filter(n=>n&&n.length>0),r.PathSegments=o,!g.isEmpty(r.QueryString)&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw S.createUrlParseError(`Given url string: ${e}`);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===a.FORWARD_SLASH){let o=new w(t).getUrlComponents();return o.Protocol+"//"+o.HostNameAndPort+e}return e}static parseHash(e){let t=e.indexOf("#"),r=e.indexOf("#/");return r>-1?e.substring(r+2):t>-1?e.substring(t+1):a.EMPTY_STRING}static parseQueryString(e){let t=e.indexOf("?"),r=e.indexOf("/?");return r>-1?e.substring(r+2):t>-1?e.substring(t+1):a.EMPTY_STRING}static constructAuthorityUriFromObject(e){return new w(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static getDeserializedHash(e){if(g.isEmpty(e))return{};let t=w.parseHash(e),r=g.queryStringToObject(g.isEmpty(t)?e:t);if(!r)throw m.createHashNotDeserializedError(JSON.stringify(r));return r}static getDeserializedQueryString(e){if(g.isEmpty(e))return{};let t=w.parseQueryString(e),r=g.queryStringToObject(g.isEmpty(t)?e:t);if(!r)throw m.createHashNotDeserializedError(JSON.stringify(r));return r}static hashContainsKnownProperties(e){if(g.isEmpty(e)||e.indexOf("=")<0)return!1;let t=w.getDeserializedHash(e);return!!(t.code||t.error_description||t.error||t.state)}};var u={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponseFromHash:"handleCodeResponseFromHash",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromiseMeasurement",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake"},Gt={NotStarted:0,InProgress:1,Completed:2},gr=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status"]);var Vr={SW:"sw",UHW:"uhw"},fe=class{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.PopTokenGenerateCnf,e.correlationId),this.performanceClient?.setPreQueueTime(u.PopTokenGenerateKid,e.correlationId);let t=yield this.generateKid(e),r=this.cryptoUtils.base64Encode(JSON.stringify(t));return{kid:t.kid,reqCnfString:r,reqCnfHash:yield this.cryptoUtils.hashString(r)}})}generateKid(e){return d(this,null,function*(){return this.performanceClient?.addQueueMeasurement(u.PopTokenGenerateKid,e.correlationId),{kid:yield this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:Vr.SW}})}signPopToken(e,t,r){return d(this,null,function*(){return this.signPayload(e,t,r)})}signPayload(e,t,r,o){return d(this,null,function*(){let{resourceRequestMethod:n,resourceRequestUri:i,shrClaims:s,shrNonce:c}=r,f=(i?new w(i):void 0)?.getUrlComponents();return yield this.cryptoUtils.signJwt(T({at:e,ts:K.nowSeconds(),m:n?.toUpperCase(),u:f?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:f?.AbsolutePath,q:f?.QueryString?[[],f.QueryString]:void 0,client_claims:s||void 0},o),t,r.correlationId)})}};var Ae=class{generateAppMetadataKey(){return Ae.generateAppMetadataCacheKey(this.environment,this.clientId)}static generateAppMetadataCacheKey(e,t){return[At,e,t].join(q.CACHE_KEY_SEPARATOR).toLowerCase()}static createAppMetadataEntity(e,t,r){let o=new Ae;return o.clientId=e,o.environment=t,r&&(o.familyId=r),o}static isAppMetadataEntity(e,t){return t?e.indexOf(At)===0&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment"):!1}};var $t=class{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}};var Ee=class{constructor(e,t,r,o,n,i,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=o,this.serializableCache=n,this.persistencePlugin=i,this.performanceClient=s}validateServerAuthorizationCodeResponse(e,t,r){if(!e.state||!t)throw e.state?m.createStateNotFoundError("Cached State"):m.createStateNotFoundError("Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw m.createStateMismatchError();if(e.error||e.error_description||e.suberror)throw z.isInteractionRequiredError(e.error,e.error_description,e.suberror)?new z(e.error||a.EMPTY_STRING,e.error_description,e.suberror,e.timestamp||a.EMPTY_STRING,e.trace_id||a.EMPTY_STRING,e.correlation_id||a.EMPTY_STRING,e.claims||a.EMPTY_STRING):new ee(e.error||a.EMPTY_STRING,e.error_description,e.suberror);e.client_info&&Xe(e.client_info,r)}validateTokenResponse(e){if(e.error||e.error_description||e.suberror){if(z.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new z(e.error,e.error_description,e.suberror,e.timestamp||a.EMPTY_STRING,e.trace_id||a.EMPTY_STRING,e.correlation_id||a.EMPTY_STRING,e.claims||a.EMPTY_STRING);let t=`${e.error_codes} - [${e.timestamp}]: ${e.error_description} - Correlation ID: ${e.correlation_id} - Trace ID: ${e.trace_id}`;throw new ee(e.error,t,e.suberror)}}handleServerTokenResponse(e,t,r,o,n,i,s,c,l){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.HandleServerTokenResponse,e.correlation_id);let f;if(e.id_token){if(f=new G(e.id_token||a.EMPTY_STRING,this.cryptoObj),n&&!g.isEmpty(n.nonce)&&f.claims.nonce!==n.nonce)throw m.createNonceMismatchError();if(o.maxAge||o.maxAge===0){let V=f.claims.auth_time;if(!V)throw m.createAuthTimeNotFoundError();G.checkMaxAge(V,o.maxAge)}}this.homeAccountIdentifier=D.generateHomeAccountId(e.client_info||a.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,f);let _;n&&n.state&&(_=Q.parseRequestState(this.cryptoObj,n.state)),e.key_id=e.key_id||o.sshKid||void 0;let N=this.generateCacheRecord(e,t,r,o,f,i,n),F;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),F=new $t(this.serializableCache,!0),yield this.persistencePlugin.beforeCacheAccess(F)),s&&!c&&N.account){let V=N.account.generateAccountKey();if(!this.cacheStorage.getAccount(V))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),Ee.generateAuthenticationResult(this.cryptoObj,t,N,!1,o,f,_,void 0,l)}yield this.cacheStorage.saveCacheRecord(N)}finally{this.persistencePlugin&&this.serializableCache&&F&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield this.persistencePlugin.afterCacheAccess(F))}return Ee.generateAuthenticationResult(this.cryptoObj,t,N,!1,o,f,_,e,l)})}generateCacheRecord(e,t,r,o,n,i,s){let c=t.getPreferredCache();if(g.isEmpty(c))throw m.createInvalidCacheEnvironmentError();let l,f;!g.isEmpty(e.id_token)&&n&&(l=se.createIdTokenEntity(this.homeAccountIdentifier,c,e.id_token||a.EMPTY_STRING,this.clientId,n.claims.tid||a.EMPTY_STRING),f=this.generateAccountEntity(e,n,t,s));let _=null;if(!g.isEmpty(e.access_token)){let V=e.scope?L.fromString(e.scope):new L(o.scopes||[]),_e=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,H=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,pe=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,Ke=r+_e,dt=Ke+H,hr=pe&&pe>0?r+pe:void 0;_=ae.createAccessTokenEntity(this.homeAccountIdentifier,c,e.access_token||a.EMPTY_STRING,this.clientId,n?n.claims.tid||a.EMPTY_STRING:t.tenant,V.printScopes(),Ke,dt,this.cryptoObj,hr,e.token_type,i,e.key_id,o.claims,o.requestedClaimsHash)}let N=null;g.isEmpty(e.refresh_token)||(N=he.createRefreshTokenEntity(this.homeAccountIdentifier,c,e.refresh_token||a.EMPTY_STRING,this.clientId,e.foci,i));let F=null;return g.isEmpty(e.foci)||(F=Ae.createAppMetadataEntity(this.clientId,c,e.foci)),new et(f,l,_,N,F)}generateAccountEntity(e,t,r,o){let n=r.authorityType,i=o?o.cloud_graph_host_name:a.EMPTY_STRING,s=o?o.msgraph_host:a.EMPTY_STRING;if(n===re.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),D.createGenericAccount(this.homeAccountIdentifier,t,r,i,s);if(g.isEmpty(e.client_info)&&r.protocolMode==="AAD")throw m.createClientInfoEmptyError();return e.client_info?D.createAccount(e.client_info,this.homeAccountIdentifier,t,r,i,s):D.createGenericAccount(this.homeAccountIdentifier,t,r,i,s)}static generateAuthenticationResult(e,t,r,o,n,i,s,c,l){return d(this,null,function*(){let f=a.EMPTY_STRING,_=[],N=null,F,V=a.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===P.POP){let pe=new fe(e),{secret:Ke,keyId:dt}=r.accessToken;if(!dt)throw m.createKeyIdMissingError();f=yield pe.signPopToken(Ke,dt,n)}else f=r.accessToken.secret;_=L.fromString(r.accessToken.target).asArray(),N=new Date(Number(r.accessToken.expiresOn)*1e3),F=new Date(Number(r.accessToken.extendedExpiresOn)*1e3)}r.appMetadata&&(V=r.appMetadata.familyId===qe?qe:a.EMPTY_STRING);let _e=i?.claims.oid||i?.claims.sub||a.EMPTY_STRING,H=i?.claims.tid||a.EMPTY_STRING;return c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid),{authority:t.canonicalAuthority,uniqueId:_e,tenantId:H,scopes:_,account:r.account?r.account.getAccountInfo():null,idToken:i?i.rawToken:a.EMPTY_STRING,idTokenClaims:i?i.claims:{},accessToken:f,fromCache:o,expiresOn:N,correlationId:n.correlationId,requestId:l||a.EMPTY_STRING,extExpiresOn:F,familyId:V,tokenType:r.accessToken?.tokenType||a.EMPTY_STRING,state:s?s.userRequestState:a.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||a.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||a.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}})}};var tt=class extends $e{constructor(e,t){super(e,t),this.includeRedirectUri=!0}getAuthCodeUrl(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.GetAuthCodeUrl,e.correlationId),this.performanceClient?.setPreQueueTime(u.AuthClientCreateQueryString,e.correlationId);let t=yield this.createAuthCodeUrlQueryString(e);return w.appendQueryString(this.authority.authorizationEndpoint,t)})}acquireToken(e,t){return d(this,null,function*(){if(!e||!e.code)throw m.createTokenRequestCannotBeMadeError();this.performanceClient?.addQueueMeasurement(u.AuthClientAcquireToken,e.correlationId);let r=this.performanceClient?.startMeasurement("AuthCodeClientAcquireToken",e.correlationId);this.logger.info("in acquireToken call in auth-code client");let o=K.nowSeconds();this.performanceClient?.setPreQueueTime(u.AuthClientExecuteTokenRequest,e.correlationId);let n=yield this.executeTokenRequest(this.authority,e),i=n.headers?.[te.X_MS_REQUEST_ID],s=n.headers?.[te.X_MS_HTTP_VERSION];s&&r?.addStaticFields({httpVerAuthority:s});let c=new Ee(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return c.validateTokenResponse(n.body),this.performanceClient?.setPreQueueTime(u.HandleServerTokenResponse,e.correlationId),c.handleServerTokenResponse(n.body,this.authority,o,e,t,void 0,void 0,void 0,i).then(l=>(r?.endMeasurement({success:!0}),l)).catch(l=>{throw this.logger.verbose("Error in fetching token in ACC",e.correlationId),r?.endMeasurement({errorCode:l.errorCode,subErrorCode:l.subError,success:!1}),l})})}handleFragmentResponse(e,t){let r=new Ee(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null),o=new w(e),n=w.getDeserializedHash(o.getHash());if(r.validateServerAuthorizationCodeResponse(n,t,this.cryptoUtils),!n.code)throw m.createNoAuthCodeInServerResponseError();return b(T({},n),{code:n.code})}getLogoutUri(e){if(!e)throw S.createEmptyLogoutRequestError();let t=this.createLogoutUrlQueryString(e);return w.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthClientExecuteTokenRequest,t.correlationId),this.performanceClient?.setPreQueueTime(u.AuthClientCreateTokenRequestBody,t.correlationId);let r=this.createTokenQueryParameters(t),o=w.appendQueryString(e.tokenEndpoint,r),n=yield this.createTokenRequestBody(t),i;if(t.clientInfo)try{let l=Xe(t.clientInfo,this.cryptoUtils);i={credential:`${l.uid}${q.CLIENT_INFO_SEPARATOR}${l.utid}`,type:ie.HOME_ACCOUNT_ID}}catch(l){this.logger.verbose("Could not parse client info for CCS Header: "+l)}let s=this.createTokenRequestHeaders(i||t.ccsCredential),c={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return this.executePostToTokenEndpoint(o,n,s,c)})}createTokenRequestBody(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthClientCreateTokenRequestBody,e.correlationId);let t=new be;if(t.addClientId(this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):we.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let n=this.config.clientCredentials.clientAssertion;t.addClientAssertion(n.assertion),t.addClientAssertionType(n.assertionType)}if(t.addGrantType(wt.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===P.POP){let n=new fe(this.cryptoUtils,this.performanceClient);this.performanceClient?.setPreQueueTime(u.PopTokenGenerateCnf,e.correlationId);let i=yield n.generateCnf(e);t.addPopToken(i.reqCnfString)}else if(e.authenticationScheme===P.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw S.createMissingSshJwkError();let r=e.correlationId||this.config.cryptoInterface.createNewGuid();t.addCorrelationId(r),(!g.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let o;if(e.clientInfo)try{let n=Xe(e.clientInfo,this.cryptoUtils);o={credential:`${n.uid}${q.CLIENT_INFO_SEPARATOR}${n.utid}`,type:ie.HOME_ACCOUNT_ID}}catch(n){this.logger.verbose("Could not parse client info for CCS Header: "+n)}else o=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&o)switch(o.type){case ie.HOME_ACCOUNT_ID:try{let n=Oe(o.credential);t.addCcsOid(n)}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case ie.UPN:t.addCcsUpn(o.credential);break}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[R.RETURN_SPA_CODE])&&t.addExtraQueryParameters({[R.RETURN_SPA_CODE]:"1"}),t.createQueryString()})}createAuthCodeUrlQueryString(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthClientCreateQueryString,e.correlationId);let t=new be;t.addClientId(this.config.authOptions.clientId);let r=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(r),t.addRedirectUri(e.redirectUri);let o=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(o),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==$.SELECT_ACCOUNT)if(e.sid&&e.prompt===$.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){let n=this.extractAccountSid(e.account),i=this.extractLoginHint(e.account);if(i){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(i);try{let s=Oe(e.account.homeAccountId);t.addCcsOid(s)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(n&&e.prompt===$.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(n);try{let s=Oe(e.account.homeAccountId);t.addCcsOid(s)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{let s=Oe(e.account.homeAccountId);t.addCcsOid(s)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(!g.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===P.POP)){let i=yield new fe(this.cryptoUtils).generateCnf(e);t.addPopToken(i.reqCnfHash)}return t.createQueryString()})}createLogoutUrlQueryString(e){let t=new be;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}};var rt=class extends $e{constructor(e,t){super(e,t)}acquireToken(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireToken,e.correlationId);let t=this.performanceClient?.startMeasurement(u.RefreshTokenClientAcquireToken,e.correlationId);this.logger.verbose("RefreshTokenClientAcquireToken called",e.correlationId);let r=K.nowSeconds();this.performanceClient?.setPreQueueTime(u.RefreshTokenClientExecuteTokenRequest,e.correlationId);let o=yield this.executeTokenRequest(e,this.authority),n=o.headers?.[te.X_MS_HTTP_VERSION];t?.addStaticFields({refreshTokenSize:o.body.refresh_token?.length||0}),n&&t?.addStaticFields({httpVerToken:n});let i=o.headers?.[te.X_MS_REQUEST_ID],s=new Ee(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(o.body),this.performanceClient?.setPreQueueTime(u.HandleServerTokenResponse,e.correlationId),s.handleServerTokenResponse(o.body,this.authority,r,e,void 0,void 0,!0,e.forceCache,i).then(c=>(t?.endMeasurement({success:!0}),c)).catch(c=>{throw this.logger.verbose("Error in fetching refresh token",e.correlationId),t?.endMeasurement({errorCode:c.errorCode,subErrorCode:c.subError,success:!1}),c})})}acquireTokenByRefreshToken(e){return d(this,null,function*(){if(!e)throw S.createEmptyTokenRequestError();if(this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw m.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return this.performanceClient?.setPreQueueTime(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.acquireTokenWithCachedRefreshToken(e,!0)}catch(r){let o=r instanceof z&&r.errorCode===Ze.noTokensFoundError.code,n=r instanceof ee&&r.errorCode===xt.INVALID_GRANT_ERROR&&r.subError===xt.CLIENT_MISMATCH_ERROR;if(o||n)return this.performanceClient?.setPreQueueTime(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.acquireTokenWithCachedRefreshToken(e,!1);throw r}return this.performanceClient?.setPreQueueTime(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.acquireTokenWithCachedRefreshToken(e,!1)})}acquireTokenWithCachedRefreshToken(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);let r=this.performanceClient?.startMeasurement(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",e.correlationId);let o=this.cacheManager.getRefreshToken(e.account,t);if(!o)throw r?.discardMeasurement(),z.createNoTokensFoundError();r?.endMeasurement({success:!0});let n=b(T({},e),{refreshToken:o.secret,authenticationScheme:e.authenticationScheme||P.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:ie.HOME_ACCOUNT_ID}});return this.performanceClient?.setPreQueueTime(u.RefreshTokenClientAcquireToken,e.correlationId),this.acquireToken(n)})}executeTokenRequest(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientExecuteTokenRequest,e.correlationId);let r=this.performanceClient?.startMeasurement(u.RefreshTokenClientExecuteTokenRequest,e.correlationId);this.performanceClient?.setPreQueueTime(u.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let o=this.createTokenQueryParameters(e),n=w.appendQueryString(t.tokenEndpoint,o),i=yield this.createTokenRequestBody(e),s=this.createTokenRequestHeaders(e.ccsCredential),c={clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return this.executePostToTokenEndpoint(n,i,s,c).then(l=>(r?.endMeasurement({success:!0}),l)).catch(l=>{throw r?.endMeasurement({success:!1}),l})})}createTokenRequestBody(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let t=e.correlationId,r=this.performanceClient?.startMeasurement(u.BaseClientCreateTokenRequestHeaders,t),o=new be;if(o.addClientId(this.config.authOptions.clientId),o.addScopes(e.scopes),o.addGrantType(wt.REFRESH_TOKEN_GRANT),o.addClientInfo(),o.addLibraryInfo(this.config.libraryInfo),o.addApplicationTelemetry(this.config.telemetry.application),o.addThrottling(),this.serverTelemetryManager&&o.addServerTelemetry(this.serverTelemetryManager),o.addCorrelationId(t),o.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&o.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let n=this.config.clientCredentials.clientAssertion;o.addClientAssertion(n.assertion),o.addClientAssertionType(n.assertionType)}if(e.authenticationScheme===P.POP){let n=new fe(this.cryptoUtils,this.performanceClient);this.performanceClient?.setPreQueueTime(u.PopTokenGenerateCnf,e.correlationId);let i=yield n.generateCnf(e);o.addPopToken(i.reqCnfString)}else if(e.authenticationScheme===P.SSH)if(e.sshJwk)o.addSshJwk(e.sshJwk);else throw r?.endMeasurement({success:!1}),S.createMissingSshJwkError();if((!g.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&o.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ie.HOME_ACCOUNT_ID:try{let n=Oe(e.ccsCredential.credential);o.addCcsOid(n)}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case ie.UPN:o.addCcsUpn(e.ccsCredential.credential);break}return r?.endMeasurement({success:!0}),o.createQueryString()})}};var bt=class extends $e{constructor(e,t){super(e,t)}acquireToken(e){return d(this,null,function*(){try{return yield this.acquireCachedToken(e)}catch(t){if(t instanceof m&&t.errorCode===E.tokenRefreshRequired.code)return new rt(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw t}})}acquireCachedToken(e){return d(this,null,function*(){if(!e)throw S.createEmptyTokenRequestError();if(e.forceRefresh)throw this.serverTelemetryManager?.setCacheOutcome(Be.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),m.createRefreshRequiredError();if(!this.config.cacheOptions.claimsBasedCachingEnabled&&!g.isEmptyObj(e.claims))throw this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because claims-based caching is disabled and claims were requested."),m.createRefreshRequiredError();if(!e.account)throw m.createNoAccountInSilentRequestError();let t=e.authority||this.authority.getPreferredCache(),r=this.cacheManager.readCacheRecord(e.account,e,t);if(r.accessToken){if(K.wasClockTurnedBack(r.accessToken.cachedAt)||K.isTokenExpired(r.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.serverTelemetryManager?.setCacheOutcome(Be.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info(`SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within ${this.config.systemOptions.tokenRenewalOffsetSeconds} seconds.`),m.createRefreshRequiredError();if(r.accessToken.refreshOn&&K.isTokenExpired(r.accessToken.refreshOn,0))throw this.serverTelemetryManager?.setCacheOutcome(Be.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),m.createRefreshRequiredError()}else throw this.serverTelemetryManager?.setCacheOutcome(Be.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),m.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),yield this.generateResultFromCacheRecord(r,e)})}generateResultFromCacheRecord(e,t){return d(this,null,function*(){let r;if(e.idToken&&(r=new G(e.idToken.secret,this.config.cryptoInterface)),t.maxAge||t.maxAge===0){let o=r?.claims.auth_time;if(!o)throw m.createAuthTimeNotFoundError();G.checkMaxAge(o,t.maxAge)}return yield Ee.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)})}};function kr(p){return p.hasOwnProperty("authorization_endpoint")&&p.hasOwnProperty("token_endpoint")&&p.hasOwnProperty("issuer")&&p.hasOwnProperty("jwks_uri")}var Rr={endpointMetadata:{"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},instanceDiscoveryMetadata:{"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}}},fr=Rr.endpointMetadata,Cr=Rr.instanceDiscoveryMetadata;var ut={AAD:"AAD",OIDC:"OIDC"};var ze=class{constructor(){this.expiresAt=K.nowSeconds()+We.REFRESH_TIME_SECONDS}updateCloudDiscoveryMetadata(e,t){this.aliases=e.aliases,this.preferred_cache=e.preferred_cache,this.preferred_network=e.preferred_network,this.aliasesFromNetwork=t}updateEndpointMetadata(e,t){this.authorization_endpoint=e.authorization_endpoint,this.token_endpoint=e.token_endpoint,this.end_session_endpoint=e.end_session_endpoint,this.issuer=e.issuer,this.endpointsFromNetwork=t,this.jwks_uri=e.jwks_uri}updateCanonicalAuthority(e){this.canonical_authority=e}resetExpiresAt(){this.expiresAt=K.nowSeconds()+We.REFRESH_TIME_SECONDS}isExpired(){return this.expiresAt<=K.nowSeconds()}static isAuthorityMetadataEntity(e,t){return t?e.indexOf(We.CACHE_KEY)===0&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri"):!1}};function br(p){return p.hasOwnProperty("tenant_discovery_endpoint")&&p.hasOwnProperty("metadata")}function Nr(p){return p.hasOwnProperty("error")&&p.hasOwnProperty("error_description")}var Pr=(()=>{class p{constructor(t,r,o){this.networkInterface=t,this.performanceClient=r,this.correlationId=o}detectRegion(t,r){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryDetectRegion,this.correlationId);let o=t;if(o)r.region_source=je.ENVIRONMENT_VARIABLE;else{let n=p.IMDS_OPTIONS;try{this.performanceClient?.setPreQueueTime(u.RegionDiscoveryGetRegionFromIMDS,this.correlationId);let i=yield this.getRegionFromIMDS(a.IMDS_VERSION,n);if(i.status===vt.httpSuccess&&(o=i.body,r.region_source=je.IMDS),i.status===vt.httpBadRequest){this.performanceClient?.setPreQueueTime(u.RegionDiscoveryGetCurrentVersion,this.correlationId);let s=yield this.getCurrentVersion(n);if(!s)return r.region_source=je.FAILED_AUTO_DETECTION,null;this.performanceClient?.setPreQueueTime(u.RegionDiscoveryGetRegionFromIMDS,this.correlationId);let c=yield this.getRegionFromIMDS(s,n);c.status===vt.httpSuccess&&(o=c.body,r.region_source=je.IMDS)}}catch{return r.region_source=je.FAILED_AUTO_DETECTION,null}}return o||(r.region_source=je.FAILED_AUTO_DETECTION),o||null})}getRegionFromIMDS(t,r){return d(this,null,function*(){return this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${a.IMDS_ENDPOINT}?api-version=${t}&format=text`,r,a.IMDS_TIMEOUT)})}getCurrentVersion(t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryGetCurrentVersion,this.correlationId);try{let r=yield this.networkInterface.sendGetRequestAsync(`${a.IMDS_ENDPOINT}?format=json`,t);return r.status===vt.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})}}return p.IMDS_OPTIONS={headers:{Metadata:"true"}},p})();var B=class{constructor(e,t,r,o,n,i,s){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=n,this.performanceClient=i,this.correlationId=s,this.regionDiscovery=new Pr(t,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(a.CIAM_AUTH_URL))return re.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case a.ADFS:return re.Adfs;case a.DSTS:return re.Dsts}return re.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new w(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw m.createLogoutNotSupportedError();return this.replacePath(this.metadata.end_session_endpoint)}else throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}canReplaceTenant(e){return e.PathSegments.length===1&&!B.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===re.Default&&this.protocolMode===ut.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,o=new w(this.metadata.canonical_authority).getUrlComponents(),n=o.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((s,c)=>{let l=n[c];if(c===0&&this.canReplaceTenant(o)){let f=new w(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==f&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${f}`),l=f)}s!==l&&(t=t.replace(`/${l}/`,`/${s}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){return this.authorityType===re.Adfs||this.protocolMode===ut.OIDC?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityResolveEndpointsAsync,this.correlationId);let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);e||(e=new ze,e.updateCanonicalAuthority(this.canonicalAuthority)),this.performanceClient?.setPreQueueTime(u.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);let t=yield this.updateCloudDiscoveryMetadata(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network),this.performanceClient?.setPreQueueTime(u.AuthorityUpdateEndpointMetadata,this.correlationId);let r=yield this.updateEndpointMetadata(e);t!==Se.CACHE&&r!==Se.CACHE&&(e.resetExpiresAt(),e.updateCanonicalAuthority(this.canonicalAuthority));let o=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(o,e),this.metadata=e})}updateEndpointMetadata(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateEndpointMetadata,this.correlationId);let t=this.getEndpointMetadataFromConfig();if(t)return e.updateEndpointMetadata(t,!1),Se.CONFIG;if(this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired())return Se.CACHE;if(this.performanceClient?.setPreQueueTime(u.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t=yield this.getEndpointMetadataFromNetwork(),t)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(this.performanceClient?.setPreQueueTime(u.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),t=yield this.updateMetadataWithRegionalInformation(t)),e.updateEndpointMetadata(t,!0),Se.NETWORK;let r=this.getEndpointMetadataFromHardcodedValues();if(r&&!this.authorityOptions.skipAuthorityMetadataCache)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(this.performanceClient?.setPreQueueTime(u.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),r=yield this.updateMetadataWithRegionalInformation(r)),e.updateEndpointMetadata(r,!1),Se.HARDCODED_VALUES;throw m.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)})}isAuthoritySameType(e){return new w(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw S.createInvalidAuthorityMetadataError()}return null}getEndpointMetadataFromNetwork(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);let e=this.performanceClient?.startMeasurement(u.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t={},r=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${r}`);try{let o=yield this.networkInterface.sendGetRequestAsync(r,t);return kr(o.body)?(e?.endMeasurement({success:!0}),o.body):(e?.endMeasurement({success:!1,errorCode:"invalid_response"}),this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(o){return e?.endMeasurement({success:!1,errorCode:"request_failure"}),this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${o}`),null}})}getEndpointMetadataFromHardcodedValues(){return this.canonicalAuthority in fr?fr[this.canonicalAuthority]:null}updateMetadataWithRegionalInformation(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==a.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=Kt.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,B.replaceWithRegionalInformation(e,t);this.performanceClient?.setPreQueueTime(u.RegionDiscoveryDetectRegion,this.correlationId);let r=yield this.regionDiscovery.detectRegion(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome=Kt.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,B.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome=Kt.AUTO_DETECTION_REQUESTED_FAILED}return e})}updateCloudDiscoveryMetadata(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),this.logger.verbose("Attempting to get cloud discovery metadata in the config"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||a.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||a.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||a.NOT_APPLICABLE}`);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in the config."),e.updateCloudDiscoveryMetadata(t,!1),Se.CONFIG;this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the cache.");let r=e.isExpired();if(this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r)return this.logger.verbose("Found metadata in the cache."),Se.CACHE;if(r&&this.logger.verbose("The metadata entity is expired."),this.logger.verbose("Did not find cloud discovery metadata in the cache... Attempting to get cloud discovery metadata from the network."),this.performanceClient?.setPreQueueTime(u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),t=yield this.getCloudDiscoveryMetadataFromNetwork(),t)return this.logger.verbose("cloud discovery metadata was successfully returned from getCloudDiscoveryMetadataFromNetwork()"),e.updateCloudDiscoveryMetadata(t,!0),Se.NETWORK;this.logger.verbose("Did not find cloud discovery metadata from the network... Attempting to get cloud discovery metadata from hardcoded values.");let o=this.getCloudDiscoveryMetadataFromHarcodedValues();if(o&&!this.options.skipAuthorityMetadataCache)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),e.updateCloudDiscoveryMetadata(o,!1),Se.HARDCODED_VALUES;throw this.logger.error("Did not find cloud discovery metadata from hardcoded values... Metadata could not be obtained from config, cache, network or hardcoded values. Throwing Untrusted Authority Error."),S.createUntrustedAuthorityError()})}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===re.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),B.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=B.getCloudDiscoveryMetadataFromNetworkResponse(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),S.createInvalidCloudDiscoveryMetadataError()}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),B.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);let e=`${a.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={},r=null;try{let o=yield this.networkInterface.sendGetRequestAsync(e,t),n,i;if(br(o.body))n=o.body,i=n.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${n.tenant_discovery_endpoint}`);else if(Nr(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),n=o.body,n.error===a.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${n.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${n.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),i=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=B.getCloudDiscoveryMetadataFromNetworkResponse(i,this.hostnameAndPort)}catch(o){if(o instanceof y)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{let n=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${n.name}
Error Description: ${n.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=B.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r})}getCloudDiscoveryMetadataFromHarcodedValues(){return this.canonicalAuthority in Cr?Cr[this.canonicalAuthority]:null}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>w.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Je.None){let o=t.tenant?t.tenant:a.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${o}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}static getCloudDiscoveryMetadataFromNetworkResponse(e,t){for(let r=0;r<e.length;r++){let o=e[r];if(o.aliases.indexOf(t)>-1)return o}return null}getPreferredCache(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw m.createEndpointDiscoveryIncompleteError("Discovery incomplete.")}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}static isPublicCloudAuthority(e){return a.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){let o=new w(e);o.validateAsUri();let n=o.getUrlComponents(),i=`${t}.${n.HostNameAndPort}`;this.isPublicCloudAuthority(n.HostNameAndPort)&&(i=`${t}.${a.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);let s=w.constructAuthorityUriFromObject(b(T({},o.getUrlComponents()),{HostNameAndPort:i})).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){return e.authorization_endpoint=B.buildRegionalAuthorityString(e.authorization_endpoint,t),e.token_endpoint=B.buildRegionalAuthorityString(e.token_endpoint,t,a.REGIONAL_AUTH_NON_MSI_QUERY_STRING),e.end_session_endpoint&&(e.end_session_endpoint=B.buildRegionalAuthorityString(e.end_session_endpoint,t)),e}static transformCIAMAuthority(e){let t=e.endsWith(a.FORWARD_SLASH)?e:`${e}${a.FORWARD_SLASH}`,o=new w(e).getUrlComponents();if(o.PathSegments.length===0&&o.HostNameAndPort.endsWith(a.CIAM_AUTH_URL)){let n=o.HostNameAndPort.split(".")[0];t=`${t}${n}${a.AAD_TENANT_DOMAIN_SUFFIX}`}return t}};B.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Fe.COMMON,Fe.CONSUMERS,Fe.ORGANIZATIONS]);var ye=class{static createDiscoveredInstance(e,t,r,o,n,i,s){return d(this,null,function*(){i?.addQueueMeasurement(u.AuthorityFactoryCreateDiscoveredInstance,s);let c=B.transformCIAMAuthority(e),l=ye.createInstance(c,t,r,o,n,i,s);try{return i?.setPreQueueTime(u.AuthorityResolveEndpointsAsync,s),yield l.resolveEndpointsAsync(),l}catch(f){throw m.createEndpointDiscoveryIncompleteError(f)}})}static createInstance(e,t,r,o,n,i,s){if(g.isEmpty(e))throw S.createUrlEmptyError();return new B(e,t,r,o,n,i,s)}};var Ue=class{constructor(){this.failedRequests=[],this.errors=[],this.cacheHits=0}static isServerTelemetryEntity(e,t){let r=e.indexOf(J.CACHE_KEY)===0,o=!0;return t&&(o=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&o}};var mt=class{static isThrottlingEntity(e,t){let r=!1;e&&(r=e.indexOf(Me.THROTTLING_PREFIX)===0);let o=!0;return t&&(o=t.hasOwnProperty("throttleTime")),r&&o}};var Er={sendGetRequestAsync:()=>{let p="Network interface - sendGetRequestAsync() has not been implemented for the Network interface.";return Promise.reject(y.createUnexpectedError(p))},sendPostRequestAsync:()=>{let p="Network interface - sendPostRequestAsync() has not been implemented for the Network interface.";return Promise.reject(y.createUnexpectedError(p))}};var zt={missingKidError:{code:"missing_kid_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided."},missingAlgError:{code:"missing_alg_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."}},He=class extends y{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,He.prototype)}static createMissingKidError(){return new He(zt.missingKidError.code,zt.missingKidError.desc)}static createMissingAlgError(){return new He(zt.missingAlgError.code,zt.missingAlgError.desc)}};var ot=class{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw He.createMissingKidError();if(!e.alg)throw He.createMissingAlgError();let t=new ot({typ:e.typ||wr.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}};var Ye=class{constructor(e,t){this.cacheOutcome=Be.NO_CACHE_HIT,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||a.EMPTY_STRING,this.wrapperVer=e.wrapperVer||a.EMPTY_STRING,this.telemetryCacheKey=J.CACHE_KEY+q.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${J.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer].join(J.VALUE_SEPARATOR),r=this.getRegionDiscoveryFields(),o=[e,r].join(J.VALUE_SEPARATOR);return[J.SCHEMA_VERSION,o,t].join(J.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=Ye.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(J.VALUE_SEPARATOR),o=e.errors.slice(0,t).join(J.VALUE_SEPARATOR),n=e.errors.length,i=t<n?J.OVERFLOW_TRUE:J.OVERFLOW_FALSE,s=[n,i].join(J.VALUE_SEPARATOR);return[J.SCHEMA_VERSION,e.cacheHits,r,o,s].join(J.CATEGORY_SEPARATOR)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=J.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof y?g.isEmpty(e.subError)?g.isEmpty(e.errorCode)?t.errors.push(e.toString()):t.errors.push(e.errorCode):t.errors.push(e.subError):t.errors.push(e.toString()):t.errors.push(J.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){let e=new Ue;return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){let e=this.getLastRequests(),t=Ye.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey);else{let o=new Ue;o.failedRequests=e.failedRequests.slice(t*2),o.errors=e.errors.slice(t),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,o)}}static maxErrorsToSend(e){let t,r=0,o=0,n=e.errors.length;for(t=0;t<n;t++){let i=e.failedRequests[2*t]||a.EMPTY_STRING,s=e.failedRequests[2*t+1]||a.EMPTY_STRING,c=e.errors[t]||a.EMPTY_STRING;if(o+=i.toString().length+s.toString().length+c.length+3,o<J.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||a.EMPTY_STRING),e.push(this.regionSource||a.EMPTY_STRING),e.push(this.regionOutcome||a.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}};var nt=class{constructor(e,t,r,o,n,i){this.authority=t,this.libraryName=o,this.libraryVersion=n,this.applicationTelemetry=i,this.clientId=e,this.logger=r,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map}startPerformanceMeasurement(e,t){return{}}getIntFields(){return gr}getPreQueueTime(e,t){let r=this.preQueueTimeByCorrelationId.get(t);if(r){if(r.name!==e){this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue time found for ${e}, unable to add queue measurement`);return}}else{this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: ${t}, unable to add queue measurement`);return}return r.time}calculateQueuedTime(e,t){return e<1?(this.logger.trace(`PerformanceClient: preQueueTime should be a positive integer and not ${e}`),0):t<1?(this.logger.trace(`PerformanceClient: currentTime should be a positive integer and not ${t}`),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e}addQueueMeasurement(e,t,r,o){if(!t){this.logger.trace(`PerformanceClient.addQueueMeasurement: correlationId not provided for ${e}, cannot add queue measurement`);return}if(r===0)this.logger.trace(`PerformanceClient.addQueueMeasurement: queue time provided for ${e} is ${r}`);else if(!r){this.logger.trace(`PerformanceClient.addQueueMeasurement: no queue time provided for ${e}`);return}let n={eventName:e,queueTime:r,manuallyCompleted:o},i=this.queueMeasurements.get(t);if(i)i.push(n),this.queueMeasurements.set(t,i);else{this.logger.trace(`PerformanceClient.addQueueMeasurement: adding correlationId ${t} to queue measurements`);let s=[n];this.queueMeasurements.set(t,s)}this.preQueueTimeByCorrelationId.delete(t)}startMeasurement(e,t){let r=t||this.generateId();t||this.logger.info(`PerformanceClient: No correlation id provided for ${e}, generating`,r),this.logger.trace(`PerformanceClient: Performance measurement started for ${e}`,r);let o=this.startPerformanceMeasurement(e,r);o.startMeasurement();let n={eventId:this.generateId(),status:Gt.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:r,appName:this.applicationTelemetry?.appName,appVersion:this.applicationTelemetry?.appVersion};return this.cacheEventByCorrelationId(n),{endMeasurement:i=>this.endMeasurement(T(T({},n),i),o),discardMeasurement:()=>this.discardMeasurements(n.correlationId),addStaticFields:i=>this.addStaticFields(i,n.correlationId),increment:i=>this.increment(i,n.correlationId),measurement:o,event:n}}endMeasurement(e,t){let r=this.eventsByCorrelationId.get(e.correlationId);if(!r)return this.logger.trace(`PerformanceClient: Measurement not found for ${e.eventId}`,e.correlationId),null;let o=e.eventId===r.eventId,n={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};o?(n=this.getQueueInfo(e.correlationId),this.discardCache(r.correlationId)):r.incompleteSubMeasurements?.delete(e.eventId),t?.endMeasurement();let i=t?.flushMeasurement();if(!i)return this.logger.trace("PerformanceClient: Performance measurement not taken",r.correlationId),null;if(this.logger.trace(`PerformanceClient: Performance measurement ended for ${e.name}: ${i} ms`,e.correlationId),!o)return r[e.name+"DurationMs"]=Math.floor(i),T({},r);let s=T(T({},r),e),c=0;return s.incompleteSubMeasurements?.forEach(l=>{this.logger.trace(`PerformanceClient: Incomplete submeasurement ${l.name} found for ${e.name}`,s.correlationId),c++}),s.incompleteSubMeasurements=void 0,s=b(T({},s),{durationMs:Math.round(i),queuedTimeMs:n.totalQueueTime,queuedCount:n.totalQueueCount,queuedManuallyCompletedCount:n.manuallyCompletedCount,status:Gt.Completed,incompleteSubsCount:c}),this.truncateIntegralFields(s,this.getIntFields()),this.emitEvents([s],e.correlationId),s}addStaticFields(e,t){this.logger.trace("PerformanceClient: Updating static fields");let r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,T(T({},r),e)):this.logger.trace("PerformanceClient: Event not found for",t)}increment(e,t){this.logger.trace("PerformanceClient: Updating counters");let r=this.eventsByCorrelationId.get(t);if(r)for(let o in e)r.hasOwnProperty(o)||(r[o]=0),r[o]+=e[o];else this.logger.trace("PerformanceClient: Event not found for",t)}cacheEventByCorrelationId(e){let t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} added/updated`,e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} started`,e.correlationId),this.eventsByCorrelationId.set(e.correlationId,T({},e)))}getQueueInfo(e){let t=this.queueMeasurements.get(e);t||this.logger.trace(`PerformanceClient: no queue measurements found for for correlationId: ${e}`);let r=0,o=0,n=0;return t?.forEach(i=>{r+=i.queueTime,o++,n+=i.manuallyCompleted?1:0}),{totalQueueTime:r,totalQueueCount:o,manuallyCompletedCount:n}}discardMeasurements(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)}discardCache(e){this.discardMeasurements(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e)}addPerformanceCallback(e){let t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose(`PerformanceClient: Performance callback registered with id: ${t}`),t}removePerformanceCallback(e){let t=this.callbacks.delete(e);return t?this.logger.verbose(`PerformanceClient: Performance callback ${e} removed.`):this.logger.verbose(`PerformanceClient: Performance callback ${e} not removed.`),t}emitEvents(e,t){this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach((r,o)=>{this.logger.trace(`PerformanceClient: Emitting event to callback ${o}`,t),r.apply(null,[e])})}truncateIntegralFields(e,t){t.forEach(r=>{r in e&&typeof e[r]=="number"&&(e[r]=Math.floor(e[r]))})}};var yr=class{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}},Nt=class extends nt{generateId(){return"callback-id"}startPerformanceMeasurement(){return new yr}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}};var Z=class{static decimalToHex(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}};var pt=class{constructor(e){this.cryptoObj=e}generateGuid(){try{let e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,Z.decimalToHex(e[0])+Z.decimalToHex(e[1])+Z.decimalToHex(e[2])+Z.decimalToHex(e[3])+"-"+Z.decimalToHex(e[4])+Z.decimalToHex(e[5])+"-"+Z.decimalToHex(e[6])+Z.decimalToHex(e[7])+"-"+Z.decimalToHex(e[8])+Z.decimalToHex(e[9])+"-"+Z.decimalToHex(e[10])+Z.decimalToHex(e[11])+Z.decimalToHex(e[12])+Z.decimalToHex(e[13])+Z.decimalToHex(e[14])+Z.decimalToHex(e[15])}catch{let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",o=0,n=a.EMPTY_STRING;for(let i=0;i<36;i++)t[i]!=="-"&&t[i]!=="4"&&(o=Math.random()*16|0),t[i]==="x"?n+=r[o]:t[i]==="y"?(o&=3,o|=8,n+=r[o]):n+=t[i];return n}}isGuid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}};var Te=class{static stringToUtf8Arr(e){let t,r=0,o=e.length;for(let i=0;i<o;i++)t=e.charCodeAt(i),r+=t<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;let n=new Uint8Array(r);for(let i=0,s=0;i<r;s++)t=e.charCodeAt(s),t<128?n[i++]=t:t<2048?(n[i++]=192+(t>>>6),n[i++]=128+(t&63)):t<65536?(n[i++]=224+(t>>>12),n[i++]=128+(t>>>6&63),n[i++]=128+(t&63)):t<2097152?(n[i++]=240+(t>>>18),n[i++]=128+(t>>>12&63),n[i++]=128+(t>>>6&63),n[i++]=128+(t&63)):t<67108864?(n[i++]=248+(t>>>24),n[i++]=128+(t>>>18&63),n[i++]=128+(t>>>12&63),n[i++]=128+(t>>>6&63),n[i++]=128+(t&63)):(n[i++]=252+(t>>>30),n[i++]=128+(t>>>24&63),n[i++]=128+(t>>>18&63),n[i++]=128+(t>>>12&63),n[i++]=128+(t>>>6&63),n[i++]=128+(t&63));return n}static utf8ArrToString(e){let t=a.EMPTY_STRING;for(let r,o=e.length,n=0;n<o;n++)r=e[n],t+=String.fromCharCode(r>251&&r<254&&n+5<o?(r-252)*1073741824+(e[++n]-128<<24)+(e[++n]-128<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:r>247&&r<252&&n+4<o?(r-248<<24)+(e[++n]-128<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:r>239&&r<248&&n+3<o?(r-240<<18)+(e[++n]-128<<12)+(e[++n]-128<<6)+e[++n]-128:r>223&&r<240&&n+2<o?(r-224<<12)+(e[++n]-128<<6)+e[++n]-128:r>191&&r<224&&n+1<o?(r-192<<6)+e[++n]-128:r);return t}static getSortedObjectString(e){return JSON.stringify(e,Object.keys(e).sort())}};var gt=class{urlEncode(e){return encodeURIComponent(this.encode(e).replace(/=/g,a.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_"))}urlEncodeArr(e){return this.base64EncArr(e).replace(/=/g,a.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")}encode(e){let t=Te.stringToUtf8Arr(e);return this.base64EncArr(t)}base64EncArr(e){let t=(3-e.length%3)%3,r=a.EMPTY_STRING;for(let o,n=e.length,i=0,s=0;s<n;s++)o=s%3,i|=e[s]<<(16>>>o&24),(o===2||e.length-s===1)&&(r+=String.fromCharCode(this.uint6ToB64(i>>>18&63),this.uint6ToB64(i>>>12&63),this.uint6ToB64(i>>>6&63),this.uint6ToB64(i&63)),i=0);return t===0?r:r.substring(0,r.length-t)+(t===1?"=":"==")}uint6ToB64(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}};var Yt=class{decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}let r=this.base64DecToArr(t);return Te.utf8ArrToString(r)}base64DecToArr(e,t){let r=e.replace(/[^A-Za-z0-9\+\/]/g,a.EMPTY_STRING),o=r.length,n=t?Math.ceil((o*3+1>>>2)/t)*t:o*3+1>>>2,i=new Uint8Array(n);for(let s,c,l=0,f=0,_=0;_<o;_++)if(c=_&3,l|=this.b64ToUint6(r.charCodeAt(_))<<18-6*c,c===3||o-_===1){for(s=0;s<3&&f<n;s++,f++)i[f]=l>>>(16>>>s&24)&255;l=0}return i}b64ToUint6(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:e===43?62:e===47?63:0}};var C={pkceNotGenerated:{code:"pkce_not_created",desc:"The PKCE code challenge and verifier could not be generated."},cryptoDoesNotExist:{code:"crypto_nonexistent",desc:"The crypto object or function is not available."},httpMethodNotImplementedError:{code:"http_method_not_implemented",desc:"The HTTP method given has not been implemented in this library."},emptyNavigateUriError:{code:"empty_navigate_uri",desc:"Navigation URI is empty. Please check stack trace for more info."},hashEmptyError:{code:"hash_empty_error",desc:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors."},hashDoesNotContainStateError:{code:"no_state_in_hash",desc:"Hash does not contain state. Please verify that the request originated from msal."},hashDoesNotContainKnownPropertiesError:{code:"hash_does_not_contain_known_properties",desc:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors."},unableToParseStateError:{code:"unable_to_parse_state",desc:"Unable to parse state. Please verify that the request originated from msal."},stateInteractionTypeMismatchError:{code:"state_interaction_type_mismatch",desc:"Hash contains state but the interaction type does not match the caller."},interactionInProgress:{code:"interaction_in_progress",desc:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors."},popupWindowError:{code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},emptyWindowError:{code:"empty_window_error",desc:"window.open returned null or undefined window object."},userCancelledError:{code:"user_cancelled",desc:"User cancelled the flow."},monitorPopupTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},monitorIframeTimeoutError:{code:"monitor_window_timeout",desc:"Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},redirectInIframeError:{code:"redirect_in_iframe",desc:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs."},blockTokenRequestsInHiddenIframeError:{code:"block_iframe_reload",desc:"Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors"},blockAcquireTokenInPopupsError:{code:"block_nested_popups",desc:"Request was blocked inside a popup because MSAL detected it was running in a popup."},iframeClosedPrematurelyError:{code:"iframe_closed_prematurely",desc:"The iframe being monitored was closed prematurely."},silentLogoutUnsupportedError:{code:"silent_logout_unsupported",desc:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead."},noAccountError:{code:"no_account_error",desc:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request."},silentPromptValueError:{code:"silent_prompt_value_error",desc:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'."},noTokenRequestCacheError:{code:"no_token_request_cache_error",desc:"No token request found in cache."},unableToParseTokenRequestCacheError:{code:"unable_to_parse_token_request_cache_error",desc:"The cached token request could not be parsed."},noCachedAuthorityError:{code:"no_cached_authority_error",desc:"No cached authority found."},authRequestNotSet:{code:"auth_request_not_set_error",desc:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler"},invalidCacheType:{code:"invalid_cache_type",desc:"Invalid cache type"},notInBrowserEnvironment:{code:"non_browser_environment",desc:"Login and token requests are not supported in non-browser environments."},databaseNotOpen:{code:"database_not_open",desc:"Database is not open!"},noNetworkConnectivity:{code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},postRequestFailed:{code:"post_request_failed",desc:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'"},getRequestFailed:{code:"get_request_failed",desc:"Network request failed. Please check the network trace to determine root cause."},failedToParseNetworkResponse:{code:"failed_to_parse_response",desc:"Failed to parse network response. Check network trace."},unableToLoadTokenError:{code:"unable_to_load_token",desc:"Error loading token to cache."},signingKeyNotFoundInStorage:{code:"crypto_key_not_found",desc:"Cryptographic Key or Keypair not found in browser storage."},authCodeRequired:{code:"auth_code_required",desc:"An authorization code must be provided (as the `code` property on the request) to this flow."},authCodeOrNativeAccountRequired:{code:"auth_code_or_nativeAccountId_required",desc:"An authorization code or nativeAccountId must be provided to this flow."},spaCodeAndNativeAccountPresent:{code:"spa_code_and_nativeAccountId_present",desc:"Request cannot contain both spa code and native account id."},databaseUnavailable:{code:"database_unavailable",desc:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts."},unableToAcquireTokenFromNativePlatform:{code:"unable_to_acquire_token_from_native_platform",desc:"Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors."},nativeHandshakeTimeout:{code:"native_handshake_timeout",desc:"Timed out while attempting to establish connection to browser extension"},nativeExtensionNotInstalled:{code:"native_extension_not_installed",desc:"Native extension is not installed. If you think this is a mistake call the initialize function."},nativeConnectionNotEstablished:{code:"native_connection_not_established",desc:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors."},nativeBrokerCalledBeforeInitialize:{code:"native_broker_called_before_initialize",desc:"You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors."},nativePromptNotSupported:{code:"native_prompt_not_supported",desc:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow."}},h=class extends y{constructor(e,t){super(e,t),Object.setPrototypeOf(this,h.prototype),this.name="BrowserAuthError"}static createPkceNotGeneratedError(e){return new h(C.pkceNotGenerated.code,`${C.pkceNotGenerated.desc} Detail:${e}`)}static createCryptoNotAvailableError(e){return new h(C.cryptoDoesNotExist.code,`${C.cryptoDoesNotExist.desc} Detail:${e}`)}static createHttpMethodNotImplementedError(e){return new h(C.httpMethodNotImplementedError.code,`${C.httpMethodNotImplementedError.desc} Given Method: ${e}`)}static createEmptyNavigationUriError(){return new h(C.emptyNavigateUriError.code,C.emptyNavigateUriError.desc)}static createEmptyHashError(){return new h(C.hashEmptyError.code,`${C.hashEmptyError.desc}`)}static createHashDoesNotContainStateError(){return new h(C.hashDoesNotContainStateError.code,C.hashDoesNotContainStateError.desc)}static createHashDoesNotContainKnownPropertiesError(){return new h(C.hashDoesNotContainKnownPropertiesError.code,C.hashDoesNotContainKnownPropertiesError.desc)}static createUnableToParseStateError(){return new h(C.unableToParseStateError.code,C.unableToParseStateError.desc)}static createStateInteractionTypeMismatchError(){return new h(C.stateInteractionTypeMismatchError.code,C.stateInteractionTypeMismatchError.desc)}static createInteractionInProgressError(){return new h(C.interactionInProgress.code,C.interactionInProgress.desc)}static createPopupWindowError(e){let t=C.popupWindowError.desc;return t=g.isEmpty(e)?t:`${t} Details: ${e}`,new h(C.popupWindowError.code,t)}static createEmptyWindowCreatedError(){return new h(C.emptyWindowError.code,C.emptyWindowError.desc)}static createUserCancelledError(){return new h(C.userCancelledError.code,C.userCancelledError.desc)}static createMonitorPopupTimeoutError(){return new h(C.monitorPopupTimeoutError.code,C.monitorPopupTimeoutError.desc)}static createMonitorIframeTimeoutError(){return new h(C.monitorIframeTimeoutError.code,C.monitorIframeTimeoutError.desc)}static createRedirectInIframeError(e){return new h(C.redirectInIframeError.code,`${C.redirectInIframeError.desc} (window.parent !== window) => ${e}`)}static createBlockReloadInHiddenIframeError(){return new h(C.blockTokenRequestsInHiddenIframeError.code,C.blockTokenRequestsInHiddenIframeError.desc)}static createBlockAcquireTokenInPopupsError(){return new h(C.blockAcquireTokenInPopupsError.code,C.blockAcquireTokenInPopupsError.desc)}static createIframeClosedPrematurelyError(){return new h(C.iframeClosedPrematurelyError.code,C.iframeClosedPrematurelyError.desc)}static createSilentLogoutUnsupportedError(){return new h(C.silentLogoutUnsupportedError.code,C.silentLogoutUnsupportedError.desc)}static createNoAccountError(){return new h(C.noAccountError.code,C.noAccountError.desc)}static createSilentPromptValueError(e){return new h(C.silentPromptValueError.code,`${C.silentPromptValueError.desc} Given value: ${e}`)}static createUnableToParseTokenRequestCacheError(){return new h(C.unableToParseTokenRequestCacheError.code,C.unableToParseTokenRequestCacheError.desc)}static createNoTokenRequestCacheError(){return new h(C.noTokenRequestCacheError.code,C.noTokenRequestCacheError.desc)}static createAuthRequestNotSetError(){return new h(C.authRequestNotSet.code,C.authRequestNotSet.desc)}static createNoCachedAuthorityError(){return new h(C.noCachedAuthorityError.code,C.noCachedAuthorityError.desc)}static createInvalidCacheTypeError(){return new h(C.invalidCacheType.code,`${C.invalidCacheType.desc}`)}static createNonBrowserEnvironmentError(){return new h(C.notInBrowserEnvironment.code,C.notInBrowserEnvironment.desc)}static createDatabaseNotOpenError(){return new h(C.databaseNotOpen.code,C.databaseNotOpen.desc)}static createNoNetworkConnectivityError(){return new h(C.noNetworkConnectivity.code,C.noNetworkConnectivity.desc)}static createPostRequestFailedError(e,t){return new h(C.postRequestFailed.code,`${C.postRequestFailed.desc} | Network client threw: ${e} | Attempted to reach: ${t.split("?")[0]}`)}static createGetRequestFailedError(e,t){return new h(C.getRequestFailed.code,`${C.getRequestFailed.desc} | Network client threw: ${e} | Attempted to reach: ${t.split("?")[0]}`)}static createFailedToParseNetworkResponseError(e){return new h(C.failedToParseNetworkResponse.code,`${C.failedToParseNetworkResponse.desc} | Attempted to reach: ${e.split("?")[0]}`)}static createUnableToLoadTokenError(e){return new h(C.unableToLoadTokenError.code,`${C.unableToLoadTokenError.desc} | ${e}`)}static createSigningKeyNotFoundInStorageError(e){return new h(C.signingKeyNotFoundInStorage.code,`${C.signingKeyNotFoundInStorage.desc} | No match found for KeyId: ${e}`)}static createAuthCodeRequiredError(){return new h(C.authCodeRequired.code,C.authCodeRequired.desc)}static createAuthCodeOrNativeAccountIdRequiredError(){return new h(C.authCodeOrNativeAccountRequired.code,C.authCodeOrNativeAccountRequired.desc)}static createSpaCodeAndNativeAccountIdPresentError(){return new h(C.spaCodeAndNativeAccountPresent.code,C.spaCodeAndNativeAccountPresent.desc)}static createDatabaseUnavailableError(){return new h(C.databaseUnavailable.code,C.databaseUnavailable.desc)}static createUnableToAcquireTokenFromNativePlatformError(){return new h(C.unableToAcquireTokenFromNativePlatform.code,C.unableToAcquireTokenFromNativePlatform.desc)}static createNativeHandshakeTimeoutError(){return new h(C.nativeHandshakeTimeout.code,C.nativeHandshakeTimeout.desc)}static createNativeExtensionNotInstalledError(){return new h(C.nativeExtensionNotInstalled.code,C.nativeExtensionNotInstalled.desc)}static createNativeConnectionNotEstablishedError(){return new h(C.nativeConnectionNotEstablished.code,C.nativeConnectionNotEstablished.desc)}static createNativeBrokerCalledBeforeInitialize(){return new h(C.nativeBrokerCalledBeforeInitialize.code,C.nativeBrokerCalledBeforeInitialize.desc)}static createNativePromptParameterNotSupportedError(){return new h(C.nativePromptNotSupported.code,C.nativePromptNotSupported.desc)}};var Wr=32,Qt=class{constructor(e){this.base64Encode=new gt,this.cryptoObj=e}generateCodes(){return d(this,null,function*(){let e=this.generateCodeVerifier(),t=yield this.generateCodeChallengeFromVerifier(e);return{verifier:e,challenge:t}})}generateCodeVerifier(){try{let e=new Uint8Array(Wr);return this.cryptoObj.getRandomValues(e),this.base64Encode.urlEncodeArr(e)}catch(e){throw h.createPkceNotGeneratedError(e)}}generateCodeChallengeFromVerifier(e){return d(this,null,function*(){try{let t=yield this.cryptoObj.sha256Digest(e);return this.base64Encode.urlEncodeArr(new Uint8Array(t))}catch(t){throw h.createPkceNotGeneratedError(t)}})}};var oe={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},it={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},De={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Y={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Ne={GET:"GET",POST:"POST"},M={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},xe={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Pt={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},x={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962},I=(()=>(I=I||{},I.Redirect="redirect",I.Popup="popup",I.Silent="silent",I.None="none",I))(),zc={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Tr={scopes:ve},Ir="jwk",Yc={React:"@azure/msal-react",Angular:"@azure/msal-angular"},Vt="msal.db",Mr=1,Or=`${Vt}.keys`,Ce={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5};var Wt=class{getRandomValues(e){return window.crypto.getRandomValues(e)}generateKey(e,t,r){return d(this,null,function*(){return window.crypto.subtle.generateKey(e,t,r)})}exportKey(e){return d(this,null,function*(){return window.crypto.subtle.exportKey(Ir,e)})}importKey(e,t,r,o){return d(this,null,function*(){return window.crypto.subtle.importKey(Ir,e,t,r,o)})}sign(e,t,r){return d(this,null,function*(){return window.crypto.subtle.sign(e,t,r)})}digest(e,t){return d(this,null,function*(){return window.crypto.subtle.digest(e,t)})}};var jr="RSASSA-PKCS1-v1_5",Ur="SHA-256",Jr=2048,Xr=new Uint8Array([1,0,1]),ft=class{constructor(e){if(this.logger=e,this.hasBrowserCrypto())this.logger.verbose("BrowserCrypto: modern crypto interface available"),this.subtleCrypto=new Wt;else throw this.logger.error("BrowserCrypto: crypto interface is unavailable"),h.createCryptoNotAvailableError("Browser crypto interface is not available.");this.keygenAlgorithmOptions={name:jr,hash:Ur,modulusLength:Jr,publicExponent:Xr}}hasBrowserCrypto(){return"crypto"in window}sha256Digest(e){return d(this,null,function*(){let t=Te.stringToUtf8Arr(e);return this.subtleCrypto.digest({name:Ur},t)})}getRandomValues(e){return this.subtleCrypto.getRandomValues(e)}generateKeyPair(e,t){return d(this,null,function*(){return this.subtleCrypto.generateKey(this.keygenAlgorithmOptions,e,t)})}exportJwk(e){return d(this,null,function*(){return this.subtleCrypto.exportKey(e)})}importJwk(e,t,r){return d(this,null,function*(){return this.subtleCrypto.importKey(e,this.keygenAlgorithmOptions,t,r)})}sign(e,t){return d(this,null,function*(){return this.subtleCrypto.sign(this.keygenAlgorithmOptions,e,t)})}};var jt=class{constructor(){this.dbName=Vt,this.version=Mr,this.tableName=Or,this.dbOpen=!1}open(){return d(this,null,function*(){return new Promise((e,t)=>{let r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",o=>{let n=o;this.db=n.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(h.createDatabaseUnavailableError()))})})}closeConnection(){let e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){return d(this,null,function*(){if(!this.dbOpen)return yield this.open()})}getItem(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(h.createDatabaseNotOpenError());let i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);i.addEventListener("success",s=>{let c=s;this.closeConnection(),t(c.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),r(s)})})})}setItem(e,t){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((r,o)=>{if(!this.db)return o(h.createDatabaseNotOpenError());let s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);s.addEventListener("success",()=>{this.closeConnection(),r()}),s.addEventListener("error",c=>{this.closeConnection(),o(c)})})})}removeItem(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(h.createDatabaseNotOpenError());let i=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);i.addEventListener("success",()=>{this.closeConnection(),t()}),i.addEventListener("error",s=>{this.closeConnection(),r(s)})})})}getKeys(){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(h.createDatabaseNotOpenError());let n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();n.addEventListener("success",i=>{let s=i;this.closeConnection(),e(s.target.result)}),n.addEventListener("error",i=>{this.closeConnection(),t(i)})})})}containsKey(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(h.createDatabaseNotOpenError());let i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);i.addEventListener("success",s=>{let c=s;this.closeConnection(),t(c.target.result===1)}),i.addEventListener("error",s=>{this.closeConnection(),r(s)})})})}deleteDatabase(){return d(this,null,function*(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{let r=window.indexedDB.deleteDatabase(Vt);r.addEventListener("success",()=>e(!0)),r.addEventListener("blocked",()=>e(!0)),r.addEventListener("error",()=>t(!1))})})}};var st=class{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){let e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}};var Mt=class{constructor(e,t){this.inMemoryCache=new st,this.indexedDBCache=new jt,this.logger=e,this.storeName=t}handleDatabaseAccessError(e){if(e instanceof h&&e.errorCode===C.databaseUnavailable.code)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}getItem(e){return d(this,null,function*(){let t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t})}setItem(e,t){return d(this,null,function*(){this.inMemoryCache.setItem(e,t);try{yield this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}})}removeItem(e){return d(this,null,function*(){this.inMemoryCache.removeItem(e);try{yield this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}})}getKeys(){return d(this,null,function*(){let e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e})}containsKey(e){return d(this,null,function*(){let t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t})}clearInMemory(){this.logger.verbose(`Deleting in-memory keystore ${this.storeName}`),this.inMemoryCache.clear(),this.logger.verbose(`In-memory keystore ${this.storeName} deleted`)}clearPersistent(){return d(this,null,function*(){try{this.logger.verbose("Deleting persistent keystore");let e=yield this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}})}};var Hr={asymmetricKeys:"asymmetricKeys",symmetricKeys:"symmetricKeys"},Jt=class{constructor(e){this.logger=e,this.asymmetricKeys=new Mt(this.logger,Hr.asymmetricKeys),this.symmetricKeys=new Mt(this.logger,Hr.symmetricKeys)}clear(){return d(this,null,function*(){this.asymmetricKeys.clearInMemory(),this.symmetricKeys.clearInMemory();try{return yield this.asymmetricKeys.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}})}};var Dr=(()=>{class p{constructor(t,r){this.logger=t,this.browserCrypto=new ft(this.logger),this.b64Encode=new gt,this.b64Decode=new Yt,this.guidGenerator=new pt(this.browserCrypto),this.pkceGenerator=new Qt(this.browserCrypto),this.cache=new Jt(this.logger),this.performanceClient=r}createNewGuid(){return this.guidGenerator.generateGuid()}base64Encode(t){return this.b64Encode.encode(t)}base64Decode(t){return this.b64Decode.decode(t)}generatePkceCodes(){return d(this,null,function*(){return this.pkceGenerator.generateCodes()})}getPublicKeyThumbprint(t){return d(this,null,function*(){let r=this.performanceClient?.startMeasurement(u.CryptoOptsGetPublicKeyThumbprint,t.correlationId),o=yield this.browserCrypto.generateKeyPair(p.EXTRACTABLE,p.POP_KEY_USAGES),n=yield this.browserCrypto.exportJwk(o.publicKey),i={e:n.e,kty:n.kty,n:n.n},s=Te.getSortedObjectString(i),c=yield this.hashString(s),l=yield this.browserCrypto.exportJwk(o.privateKey),f=yield this.browserCrypto.importJwk(l,!1,["sign"]);return yield this.cache.asymmetricKeys.setItem(c,{privateKey:f,publicKey:o.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri}),r&&r.endMeasurement({success:!0}),c})}removeTokenBindingKey(t){return d(this,null,function*(){return yield this.cache.asymmetricKeys.removeItem(t),!(yield this.cache.asymmetricKeys.containsKey(t))})}clearKeystore(){return d(this,null,function*(){return yield this.cache.clear()})}signJwt(t,r,o){return d(this,null,function*(){let n=this.performanceClient?.startMeasurement(u.CryptoOptsSignJwt,o),i=yield this.cache.asymmetricKeys.getItem(r);if(!i)throw h.createSigningKeyNotFoundInStorageError(r);let s=yield this.browserCrypto.exportJwk(i.publicKey),c=Te.getSortedObjectString(s),l=this.b64Encode.urlEncode(JSON.stringify({kid:r})),f=ot.getShrHeaderString({kid:l,alg:s.alg}),_=this.b64Encode.urlEncode(f);t.cnf={jwk:JSON.parse(c)};let N=this.b64Encode.urlEncode(JSON.stringify(t)),F=`${_}.${N}`,V=Te.stringToUtf8Arr(F),_e=yield this.browserCrypto.sign(i.privateKey,V),H=this.b64Encode.urlEncodeArr(new Uint8Array(_e)),pe=`${F}.${H}`;return n&&n.endMeasurement({success:!0}),pe})}hashString(t){return d(this,null,function*(){let r=yield this.browserCrypto.sha256Digest(t),o=new Uint8Array(r);return this.b64Encode.urlEncodeArr(o)})}}return p.POP_KEY_USAGES=["sign","verify"],p.EXTRACTABLE=!0,p})();var ue={redirectUriNotSet:{code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},postLogoutUriNotSet:{code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},storageNotSupportedError:{code:"storage_not_supported",desc:"Given storage configuration option was not supported."},noRedirectCallbacksSet:{code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},invalidCallbackObject:{code:"invalid_callback_object",desc:"The object passed for the callback was invalid. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},stubPcaInstanceCalled:{code:"stubbed_public_client_application_called",desc:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors"},inMemRedirectUnavailable:{code:"in_mem_redirect_unavailable",desc:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},entropyNotProvided:{code:"entropy_not_provided",desc:"The available browser crypto interface requires entropy set via system.cryptoOptions.entropy configuration option."}},ce=class extends y{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,ce.prototype)}static createRedirectUriEmptyError(){return new ce(ue.redirectUriNotSet.code,ue.redirectUriNotSet.desc)}static createPostLogoutRedirectUriEmptyError(){return new ce(ue.postLogoutUriNotSet.code,ue.postLogoutUriNotSet.desc)}static createStorageNotSupportedError(e){return new ce(ue.storageNotSupportedError.code,`${ue.storageNotSupportedError.desc} Given Location: ${e}`)}static createRedirectCallbacksNotSetError(){return new ce(ue.noRedirectCallbacksSet.code,ue.noRedirectCallbacksSet.desc)}static createStubPcaInstanceCalledError(){return new ce(ue.stubPcaInstanceCalled.code,ue.stubPcaInstanceCalled.desc)}static createInMemoryRedirectUnavailableError(){return new ce(ue.inMemRedirectUnavailable.code,ue.inMemRedirectUnavailable.desc)}static createEntropyNotProvided(){return new ce(ue.entropyNotProvided.code,ue.entropyNotProvided.desc)}};var Ot=class{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==Y.LocalStorage&&e!==Y.SessionStorage)throw ce.createStorageNotSupportedError(e);if(!!!window[e])throw ce.createStorageNotSupportedError(e)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}};var Ct=class{static extractBrowserRequestState(e,t){if(g.isEmpty(t))return null;try{return Q.parseRequestState(e,t).libraryState.meta}catch(r){throw m.createInvalidStateError(t,r)}}static parseServerResponseFromHash(e){if(!e)return{};let t=new w(e);return w.getDeserializedHash(t.getHash())}};var Le=class extends X{constructor(e,t,r,o){super(e,r,o),this.COOKIE_LIFE_MULTIPLIER=24*60*60*1e3,this.cacheConfig=t,this.logger=o,this.internalStorage=new st,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps())}setupBrowserStorage(e){switch(e){case Y.LocalStorage:case Y.SessionStorage:try{return new Ot(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=Y.MemoryStorage,new st}setupTemporaryCacheStorage(e,t){switch(t){case Y.LocalStorage:case Y.SessionStorage:try{return new Ot(e||Y.SessionStorage)}catch(r){return this.logger.verbose(r),this.internalStorage}case Y.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){let e=`${a.CACHE_PREFIX}.${j.ID_TOKEN}`,t=`${a.CACHE_PREFIX}.${j.CLIENT_INFO}`,r=`${a.CACHE_PREFIX}.${j.ERROR}`,o=`${a.CACHE_PREFIX}.${j.ERROR_DESC}`,n=this.browserStorage.getItem(e),i=this.browserStorage.getItem(t),s=this.browserStorage.getItem(r),c=this.browserStorage.getItem(o),l=[n,i,s,c];[j.ID_TOKEN,j.CLIENT_INFO,j.ERROR,j.ERROR_DESC].forEach((_,N)=>this.migrateCacheEntry(_,l[N]))}migrateCacheEntry(e,t){t&&this.setTemporaryCache(e,t,!0)}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");let e=this.getItem(xe.ACCOUNT_KEYS),t=this.getItem(`${xe.TOKEN_KEYS}.${this.clientId}`);if(e&&t){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(o=>{if(this.isCredentialKey(o)){let n=this.getItem(o);if(n){let i=this.validateAndParseJson(n);if(i&&i.hasOwnProperty("credentialType"))switch(i.credentialType){case A.ID_TOKEN:if(se.isIdTokenEntity(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${o} found, saving key to token key map`);let s=X.toObject(new se,i),c=this.updateCredentialCacheKey(o,s);this.addTokenKey(c,A.ID_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${o}`);break;case A.ACCESS_TOKEN:case A.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(ae.isAccessTokenEntity(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${o} found, saving key to token key map`);let s=X.toObject(new ae,i),c=this.updateCredentialCacheKey(o,s);this.addTokenKey(c,A.ACCESS_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${o}`);break;case A.REFRESH_TOKEN:if(he.isRefreshTokenEntity(i)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${o} found, saving key to token key map`);let s=X.toObject(new he,i),c=this.updateCredentialCacheKey(o,s);this.addTokenKey(c,A.REFRESH_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${o}`);break}}}if(this.isAccountKey(o)){let n=this.getItem(o);if(n){let i=this.validateAndParseJson(n);i&&D.isAccountEntity(i)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${o} found, saving key to account key map`),this.addAccountKeyToMap(o))}}})}validateAndParseJson(e){try{let t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e){this.logger.trace("BrowserCacheManager.getAccount called");let t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;let r=this.validateAndParseJson(t);return!r||!D.isAccountEntity(r)?(this.removeAccountKeyFromMap(e),null):X.toObject(new D,r)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");let t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");let e=this.getItem(xe.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);let t=this.getAccountKeys();t.indexOf(e)===-1?(t.push(e),this.setItem(xe.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);let t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(xe.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e){return d(this,null,function*(){mr(Le.prototype,this,"removeAccount").call(this,e),this.removeAccountKeyFromMap(e)})}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,A.ID_TOKEN)}removeAccessToken(e){return d(this,null,function*(){mr(Le.prototype,this,"removeAccessToken").call(this,e),this.removeTokenKey(e,A.ACCESS_TOKEN)})}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,A.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");let e=this.getItem(`${xe.TOKEN_KEYS}.${this.clientId}`);if(e){let t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");let r=this.getTokenKeys();switch(t){case A.ID_TOKEN:r.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case A.ACCESS_TOKEN:r.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case A.REFRESH_TOKEN:r.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),m.createUnexpectedCredentialTypeError()}this.setItem(`${xe.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");let r=this.getTokenKeys();switch(t){case A.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);let o=r.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case A.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);let n=r.accessToken.indexOf(e);n>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(n,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case A.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);let i=r.refreshToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),m.createUnexpectedCredentialTypeError()}this.setItem(`${xe.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.ID_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!se.isIdTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),X.toObject(new se,r))}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");let t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,A.ID_TOKEN)}getAccessTokenCredential(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.ACCESS_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!ae.isAccessTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),X.toObject(new ae,r))}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");let t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,A.ACCESS_TOKEN)}getRefreshTokenCredential(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.REFRESH_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!he.isRefreshTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,A.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),X.toObject(new he,r))}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");let t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,A.REFRESH_TOKEN)}getAppMetadata(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!Ae.isAppMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),X.toObject(new Ae,r))}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");let t=e.generateAppMetadataKey();this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!Ue.isServerTelemetryEntity(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),X.toObject(new Ue,r))}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){let t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&ze.isAuthorityMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),X.toObject(new ze,r)):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Pt.WRAPPER_SKU,e),this.internalStorage.setItem(Pt.WRAPPER_VER,t)}getWrapperMetadata(){let e=this.internalStorage.getItem(Pt.WRAPPER_SKU)||a.EMPTY_STRING,t=this.internalStorage.getItem(Pt.WRAPPER_VER)||a.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){let e=this.generateCacheKey(j.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");let o=this.generateCacheKey(j.ACTIVE_ACCOUNT),n=this.getItem(o);if(!n)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;let i=this.getAccountInfoByFilter({localAccountId:n})[0]||null;return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i),i):null}let r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoByFilter({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId})[0]||null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){let t=this.generateCacheKey(j.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(j.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");let o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId};this.browserStorage.setItem(t,JSON.stringify(o)),this.browserStorage.setItem(r,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r)}getAccountInfoByFilter(e){let t=this.getAllAccounts();return this.logger.trace(`BrowserCacheManager.getAccountInfoByFilter: total ${t.length} accounts found`),t.filter(r=>!(e.username&&e.username.toLowerCase()!==r.username.toLowerCase()||e.homeAccountId&&e.homeAccountId!==r.homeAccountId||e.localAccountId&&e.localAccountId!==r.localAccountId||e.tenantId&&e.tenantId!==r.tenantId||e.environment&&e.environment!==r.environment))}getAccountInfoByHints(e,t){let r=this.getAllAccounts().filter(o=>{if(t){let n=o.idTokenClaims&&o.idTokenClaims.sid;return t===n}return e?e===o.username:!1});if(r.length===1)return r[0];if(r.length>1)throw m.createMultipleMatchingAccountsInCacheError();return null}getThrottlingCache(e){let t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!mt.isThrottlingEntity(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),X.toObject(new mt,r))}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){let r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){let n=this.getItemCookie(r);if(n)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),n}let o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===Y.LocalStorage){let n=this.browserStorage.getItem(r);if(n)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),n}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){let o=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(o,t))}removeItem(e){this.browserStorage.removeItem(e),this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}containsKey(e){return this.browserStorage.containsKey(e)||this.temporaryCacheStorage.containsKey(e)}getKeys(){return[...this.browserStorage.getKeys(),...this.temporaryCacheStorage.getKeys()]}clear(){return d(this,null,function*(){yield this.removeAllAccounts(),this.removeAppMetadata(),this.getKeys().forEach(e=>{(this.browserStorage.containsKey(e)||this.temporaryCacheStorage.containsKey(e))&&(e.indexOf(a.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeItem(e)}),this.internalStorage.clear()})}setItemCookie(e,t,r){let o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){let n=this.getCookieExpirationTime(r);o+=`expires=${n};`}this.cacheConfig.secureCookies&&(o+="Secure;"),document.cookie=o}getItemCookie(e){let t=`${encodeURIComponent(e)}=`,r=document.cookie.split(";");for(let o=0;o<r.length;o++){let n=r[o];for(;n.charAt(0)===" ";)n=n.substring(1);if(n.indexOf(t)===0)return decodeURIComponent(n.substring(t.length,n.length))}return a.EMPTY_STRING}clearMsalCookies(){let e=`${a.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(r=>{for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(e)===0){let o=r.split("=")[0];this.clearItemCookie(o)}})}clearItemCookie(e){this.setItemCookie(e,a.EMPTY_STRING,-1)}getCookieExpirationTime(e){let t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}getCache(){return this.browserStorage}setCache(){}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):g.startsWith(e,a.CACHE_PREFIX)||g.startsWith(e,j.ADAL_ID_TOKEN)?e:`${a.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){let{libraryState:{id:t}}=Q.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${M.AUTHORITY}.${t}`)}generateNonceKey(e){let{libraryState:{id:t}}=Q.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${M.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){let{libraryState:{id:t}}=Q.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${M.REQUEST_STATE}.${t}`)}getCachedAuthority(e){let t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;let o=this.generateAuthorityKey(r);return this.getTemporaryCache(o)}updateCacheEntries(e,t,r,o,n){this.logger.trace("BrowserCacheManager.updateCacheEntries called");let i=this.generateStateKey(e);this.setTemporaryCache(i,e,!1);let s=this.generateNonceKey(e);this.setTemporaryCache(s,t,!1);let c=this.generateAuthorityKey(e);if(this.setTemporaryCache(c,r,!1),n){let l={credential:n.homeAccountId,type:ie.HOME_ACCOUNT_ID};this.setTemporaryCache(M.CCS_CREDENTIAL,JSON.stringify(l),!0)}else if(!g.isEmpty(o)){let l={credential:o,type:ie.UPN};this.setTemporaryCache(M.CCS_CREDENTIAL,JSON.stringify(l),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),g.isEmpty(e)||this.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeItem(t)}),e&&(this.removeItem(this.generateStateKey(e)),this.removeItem(this.generateNonceKey(e)),this.removeItem(this.generateAuthorityKey(e))),this.removeItem(this.generateCacheKey(M.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(M.ORIGIN_URI)),this.removeItem(this.generateCacheKey(M.URL_HASH)),this.removeItem(this.generateCacheKey(M.CORRELATION_ID)),this.removeItem(this.generateCacheKey(M.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(M.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){let t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||a.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach(t=>{if(t.indexOf(M.REQUEST_STATE)===-1)return;let r=this.temporaryCacheStorage.getItem(t);if(!r)return;let o=Ct.extractBrowserRequestState(this.cryptoImpl,r);o&&o.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");let r=t.base64Encode(JSON.stringify(e));this.setTemporaryCache(M.REQUEST_PARAMS,r,!0)}getCachedRequest(e,t){this.logger.trace("BrowserCacheManager.getCachedRequest called");let r=this.getTemporaryCache(M.REQUEST_PARAMS,!0);if(!r)throw h.createNoTokenRequestCacheError();let o=this.validateAndParseJson(t.base64Decode(r));if(!o)throw h.createUnableToParseTokenRequestCacheError();if(this.removeItem(this.generateCacheKey(M.REQUEST_PARAMS)),g.isEmpty(o.authority)){let n=this.generateAuthorityKey(e),i=this.getTemporaryCache(n);if(!i)throw h.createNoCachedAuthorityError();o.authority=i}return o}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");let e=this.getTemporaryCache(M.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;let t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){let t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){let e=`${a.CACHE_PREFIX}.${M.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){let t=`${a.CACHE_PREFIX}.${M.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw h.createInteractionInProgressError();this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeItem(t)}getLegacyLoginHint(){let e=this.getTemporaryCache(j.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(j.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));let t=this.getTemporaryCache(j.ID_TOKEN,!0);t&&(this.removeItem(this.generateCacheKey(j.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));let r=t||e;if(r){let o=new G(r,this.cryptoImpl);if(o.claims&&o.claims.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),o.claims.preferred_username;if(o.claims&&o.claims.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),o.claims.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){let r=t.generateCredentialKey();if(e!==r){let o=this.getItem(e);if(o)return this.removeItem(e),this.setItem(r,o),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}getRedirectRequestContext(){return this.getTemporaryCache(M.REDIRECT_CONTEXT,!0)}setRedirectRequestContext(e){this.setTemporaryCache(M.REDIRECT_CONTEXT,e,!0)}},xr=(p,e)=>{let t={cacheLocation:Y.MemoryStorage,temporaryCacheLocation:Y.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Le(p,t,Ge,e)};var Xt=class{sendGetRequestAsync(e,t){return d(this,null,function*(){let r;try{r=yield fetch(e,{method:Ne.GET,headers:this.getFetchHeaders(t)})}catch(o){throw window.navigator.onLine?h.createGetRequestFailedError(o,e):h.createNoNetworkConnectivityError()}try{return{headers:this.getHeaderDict(r.headers),body:yield r.json(),status:r.status}}catch{throw h.createFailedToParseNetworkResponseError(e)}})}sendPostRequestAsync(e,t){return d(this,null,function*(){let r=t&&t.body||a.EMPTY_STRING,o;try{o=yield fetch(e,{method:Ne.POST,headers:this.getFetchHeaders(t),body:r})}catch(n){throw window.navigator.onLine?h.createPostRequestFailedError(n,e):h.createNoNetworkConnectivityError()}try{return{headers:this.getHeaderDict(o.headers),body:yield o.json(),status:o.status}}catch{throw h.createFailedToParseNetworkResponseError(e)}})}getFetchHeaders(e){let t=new Headers;if(!(e&&e.headers))return t;let r=e.headers;return Object.keys(r).forEach(o=>{t.append(o,r[o])}),t}getHeaderDict(e){let t={};return e.forEach((r,o)=>{t[o]=r}),t}};var Zt=class{sendGetRequestAsync(e,t){return d(this,null,function*(){return this.sendRequestAsync(e,Ne.GET,t)})}sendPostRequestAsync(e,t){return d(this,null,function*(){return this.sendRequestAsync(e,Ne.POST,t)})}sendRequestAsync(e,t,r){return new Promise((o,n)=>{let i=new XMLHttpRequest;if(i.open(t,e,!0),this.setXhrHeaders(i,r),i.onload=()=>{(i.status<200||i.status>=300)&&(t===Ne.POST?n(h.createPostRequestFailedError(`Failed with status ${i.status}`,e)):n(h.createGetRequestFailedError(`Failed with status ${i.status}`,e)));try{let s=JSON.parse(i.responseText),c={headers:this.getHeaderDict(i),body:s,status:i.status};o(c)}catch{n(h.createFailedToParseNetworkResponseError(e))}},i.onerror=()=>{window.navigator.onLine?t===Ne.POST?n(h.createPostRequestFailedError(`Failed with status ${i.status}`,e)):n(h.createGetRequestFailedError(`Failed with status ${i.status}`,e)):n(h.createNoNetworkConnectivityError())},t===Ne.POST&&r&&r.body)i.send(r.body);else if(t===Ne.GET)i.send();else throw h.createHttpMethodNotImplementedError(t)})}setXhrHeaders(e,t){if(t&&t.headers){let r=t.headers;Object.keys(r).forEach(o=>{e.setRequestHeader(o,r[o])})}}getHeaderDict(e){let r=e.getAllResponseHeaders().trim().split(/[\r\n]+/),o={};return r.forEach(n=>{let i=n.split(": "),s=i.shift(),c=i.join(": ");s&&c&&(o[s]=c)}),o}};var O=class{static clearHash(e){e.location.hash=a.EMPTY_STRING,typeof e.history.replaceState=="function"&&e.history.replaceState(null,a.EMPTY_STRING,`${e.location.origin}${e.location.pathname}${e.location.search}`)}static replaceHash(e){let t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):a.EMPTY_STRING}static isInIframe(){return window.parent!==window}static isInPopup(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${oe.POPUP_NAME_PREFIX}.`)===0}static getCurrentUri(){return window.location.href.split("?")[0].split("#")[0]}static getHomepage(){let t=new w(window.location.href).getUrlComponents();return`${t.Protocol}//${t.HostNameAndPort}/`}static getBrowserNetworkClient(){return window.fetch&&window.Headers?new Xt:new Zt}static blockReloadInHiddenIframes(){if(w.hashContainsKnownProperties(window.location.hash)&&O.isInIframe())throw h.createBlockReloadInHiddenIframeError()}static blockRedirectInIframe(e,t){let r=O.isInIframe();if(e===I.Redirect&&r&&!t)throw h.createRedirectInIframeError(r)}static blockAcquireTokenInPopups(){if(O.isInPopup())throw h.createBlockAcquireTokenInPopupsError()}static blockNonBrowserEnvironment(e){if(!e)throw h.createNonBrowserEnvironmentError()}static blockNativeBrokerCalledBeforeInitialized(e,t){if(e&&!t)throw h.createNativeBrokerCalledBeforeInitialize()}static detectIEOrEdge(){let e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/"),o=e.indexOf("Edge/"),n=t>0||r>0,i=o>0;return n||i}};var v={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};var er=class{constructor(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(e){if(typeof window<"u"){let t=this.browserCrypto.createNewGuid();return this.eventCallbacks.set(t,e),this.logger.verbose(`Event callback registered with id: ${t}`),t}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(e,t,r,o){if(typeof window<"u"){let n={eventType:e,interactionType:t||null,payload:r||null,error:o||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${e}`),this.eventCallbacks.forEach((i,s)=>{this.logger.verbose(`Emitting event to callback ${s}: ${e}`),i.apply(null,[n])})}}handleAccountCacheChange(e){try{let t=e.newValue||e.oldValue;if(!t)return;let r=JSON.parse(t);if(typeof r!="object"||!D.isAccountEntity(r))return;let n=X.toObject(new D,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(v.ACCOUNT_ADDED,void 0,n)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(v.ACCOUNT_REMOVED,void 0,n))}catch{return}}};var _r="@azure/msal-browser",at="3.0.0-beta.1";var Et=class{constructor(e,t,r,o,n,i,s,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=n,this.navigationClient=i,this.nativeMessageHandler=c,this.correlationId=l||this.browserCrypto.createNewGuid(),this.logger=o.clone(oe.MSAL_SKU,at,this.correlationId),this.performanceClient=s}clearCacheOnLogout(e){return d(this,null,function*(){if(e){D.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{yield this.browserStorage.removeAccount(D.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),yield this.browserStorage.clear(),yield this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})}initializeBaseRequest(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.InitializeBaseRequest,e.correlationId),this.logger.verbose("Initializing BaseAuthRequest");let r=e.authority||this.config.auth.authority;t&&(yield this.validateRequestAuthority(r,t));let o=[...e&&e.scopes||[]],n=b(T({},e),{correlationId:this.correlationId,authority:r,scopes:o});if(!n.authenticationScheme)n.authenticationScheme=P.BEARER,this.logger.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(n.authenticationScheme===P.SSH){if(!e.sshJwk)throw S.createMissingSshJwkError();if(!e.sshKid)throw S.createMissingSshKidError()}this.logger.verbose(`Authentication Scheme set to "${n.authenticationScheme}" as configured in Auth request`)}return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!g.isEmptyObj(e.claims)&&(n.requestedClaimsHash=yield this.browserCrypto.hashString(e.claims)),n})}getRedirectUri(e){this.logger.verbose("getRedirectUri called");let t=e||this.config.auth.redirectUri||O.getCurrentUri();return w.getAbsoluteUrl(t,O.getCurrentUri())}validateRequestAuthority(e,t){return d(this,null,function*(){if(!(yield this.getDiscoveredAuthority(e)).isAlias(t.environment))throw S.createAuthorityMismatchError()})}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");let r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ye(r,this.browserStorage)}getDiscoveredAuthority(e){return d(this,null,function*(){this.logger.verbose("getDiscoveredAuthority called");let t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata};return e?(this.logger.verbose("Creating discovered authority with request authority"),yield ye.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t,this.logger)):(this.logger.verbose("Creating discovered authority with configured authority"),yield ye.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t,this.logger))})}};var me=class extends Et{initializeAuthorizationCodeRequest(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),this.logger.verbose("initializeAuthorizationRequest called",e.correlationId);let t=yield this.browserCrypto.generatePkceCodes(),r=b(T({},e),{redirectUri:e.redirectUri,code:a.EMPTY_STRING,codeVerifier:t.verifier});return e.codeChallenge=t.challenge,e.codeChallengeMethod=a.S256_CODE_CHALLENGE_METHOD,r})}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);let t=T({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){let r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=w.getAbsoluteUrl(e.postLogoutRedirectUri,O.getCurrentUri())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=w.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,O.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=w.getAbsoluteUrl(O.getCurrentUri(),O.getCurrentUri())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){let t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e,t,r){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientCreateAuthCodeClient,this.correlationId),this.performanceClient.setPreQueueTime(u.StandardInteractionClientGetClientConfiguration,this.correlationId);let o=yield this.getClientConfiguration(e,t,r);return new tt(o,this.performanceClient)})}getClientConfiguration(e,t,r){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetClientConfiguration,this.correlationId),this.logger.verbose("getClientConfiguration called",this.correlationId),this.performanceClient.setPreQueueTime(u.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);let o=yield this.getDiscoveredAuthority(t,r),n=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:o,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:n.loggerCallback,piiLoggingEnabled:n.piiLoggingEnabled,logLevel:n.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:oe.MSAL_SKU,version:at,cpu:a.EMPTY_STRING,os:a.EMPTY_STRING},telemetry:this.config.telemetry}})}validateAndExtractStateFromHash(e,t,r){if(this.logger.verbose("validateAndExtractStateFromHash called",r),!e.state)throw h.createHashDoesNotContainStateError();let o=Ct.extractBrowserRequestState(this.browserCrypto,e.state);if(!o)throw h.createUnableToParseStateError();if(o.interactionType!==t)throw h.createStateInteractionTypeMismatchError();return this.logger.verbose("Returning state from hash",r),e.state}getDiscoveredAuthority(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),this.logger.verbose("getDiscoveredAuthority called",this.correlationId);let r=this.performanceClient?.startMeasurement(u.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},n=e||this.config.auth.authority,i=B.generateAuthority(n,t||this.config.auth.azureCloudOptions);return this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),this.performanceClient.setPreQueueTime(u.AuthorityFactoryCreateDiscoveredInstance,this.correlationId),yield ye.createDiscoveredInstance(i,this.config.system.networkClient,this.browserStorage,o,this.logger,this.performanceClient,this.correlationId).then(s=>(r.endMeasurement({success:!0}),s)).catch(s=>{throw r.endMeasurement({errorCode:s.errorCode,subErrorCode:s.subError,success:!1}),s})})}initializeAuthorizationRequest(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId),this.logger.verbose("initializeAuthorizationRequest called",this.correlationId);let r=this.getRedirectUri(e.redirectUri),o={interactionType:t},n=Q.setRequestState(this.browserCrypto,e&&e.state||a.EMPTY_STRING,o);this.performanceClient.setPreQueueTime(u.InitializeBaseRequest,this.correlationId);let i=b(T({},yield this.initializeBaseRequest(e)),{redirectUri:r,state:n,nonce:e.nonce||this.browserCrypto.createNewGuid(),responseMode:St.FRAGMENT}),s=e.account||this.browserStorage.getActiveAccount();if(s&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${s.homeAccountId}`,this.correlationId),i.account=s),g.isEmpty(i.loginHint)&&!s){let c=this.browserStorage.getLegacyLoginHint();c&&(i.loginHint=c)}return i})}};var Zr=-2147186943,yt={USER_INTERACTION_REQUIRED:"USER_INTERACTION_REQUIRED",USER_CANCEL:"USER_CANCEL",NO_NETWORK:"NO_NETWORK",TRANSIENT_ERROR:"TRANSIENT_ERROR",PERSISTENT_ERROR:"PERSISTENT_ERROR",DISABLED:"DISABLED",ACCOUNT_UNAVAILABLE:"ACCOUNT_UNAVAILABLE"},Ut={extensionError:{code:"ContentError"},userSwitch:{code:"user_switch",desc:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."},tokensNotFoundInCache:{code:"tokens_not_found_in_internal_memory_cache",desc:"Tokens not cached in MSAL JS internal memory, please make the WAM request"}},W=class extends y{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,W.prototype),this.name="NativeAuthError",this.ext=r}isFatal(){if(this.ext&&this.ext.status&&(this.ext.status===yt.PERSISTENT_ERROR||this.ext.status===yt.DISABLED)||this.ext&&this.ext.error&&this.ext.error===Zr)return!0;switch(this.errorCode){case Ut.extensionError.code:return!0;default:return!1}}static createError(e,t,r){if(r&&r.status)switch(r.status){case yt.ACCOUNT_UNAVAILABLE:return z.createNativeAccountUnavailableError();case yt.USER_INTERACTION_REQUIRED:return new z(e,t);case yt.USER_CANCEL:return h.createUserCancelledError();case yt.NO_NETWORK:return h.createNoNetworkConnectivityError()}return new W(e,t,r)}static createUserSwitchError(){return new W(Ut.userSwitch.code,Ut.userSwitch.desc)}static createTokensNotFoundInCacheError(){return new W(Ut.tokensNotFoundInCache.code,Ut.tokensNotFoundInCache.desc)}};var Tt=class extends me{acquireToken(e){return d(this,null,function*(){let t=this.performanceClient.startMeasurement(u.SilentCacheClientAcquireToken,e.correlationId),r=this.initializeServerTelemetryManager(x.acquireTokenSilent_silentFlow),o=yield this.createSilentFlowClient(r,e.authority,e.azureCloudOptions);this.logger.verbose("Silent auth client created");try{let n=yield o.acquireCachedToken(e);return t.endMeasurement({success:!0,fromCache:!0}),n}catch(n){throw n instanceof h&&n.errorCode===C.signingKeyNotFoundInStorage.code&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),t.endMeasurement({errorCode:n instanceof y&&n.errorCode||void 0,subErrorCode:n instanceof y&&n.subError||void 0,success:!1}),n}})}logout(){return Promise.reject(h.createSilentLogoutUnsupportedError())}createSilentFlowClient(e,t,r){return d(this,null,function*(){this.performanceClient.setPreQueueTime(u.StandardInteractionClientGetClientConfiguration,this.correlationId);let o=yield this.getClientConfiguration(e,t,r);return new bt(o,this.performanceClient)})}initializeSilentRequest(e,t){return d(this,null,function*(){return this.performanceClient.addQueueMeasurement(u.InitializeSilentRequest,this.correlationId),this.performanceClient.setPreQueueTime(u.InitializeBaseRequest,this.correlationId),b(T(T({},e),yield this.initializeBaseRequest(e,t)),{account:t,forceRefresh:e.forceRefresh||!1})})}};var Qe=class extends et{constructor(e,t,r,o,n){super(e,t,r,o,n),this.account=e}};var Ie=class extends Et{constructor(e,t,r,o,n,i,s,c,l,f,_,N){super(e,t,r,o,n,i,c,l,N),this.apiId=s,this.accountId=f,this.nativeMessageHandler=l,this.nativeStorageManager=_,this.silentCacheClient=new Tt(e,this.nativeStorageManager,r,o,n,i,c,l,N)}acquireToken(e){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - acquireToken called.");let t=this.performanceClient.startMeasurement(u.NativeInteractionClientAcquireToken,e.correlationId),r=K.nowSeconds(),o=yield this.initializeNativeRequest(e);try{let c=yield this.acquireTokensFromCache(this.accountId,o);return t.endMeasurement({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}let n={method:De.GetToken,request:o},i=yield this.nativeMessageHandler.sendMessage(n),s=this.validateNativeResponse(i);return this.handleNativeResponse(s,o,r).then(c=>(t.endMeasurement({success:!0,isNativeBroker:!0,requestId:c.requestId}),c)).catch(c=>{throw t.endMeasurement({success:!1,errorCode:c.errorCode,subErrorCode:c.subError,isNativeBroker:!0}),c})})}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:L.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){return d(this,null,function*(){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),m.createNoAccountFoundError();let r=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:e});if(!r)throw m.createNoAccountFoundError();try{let o=this.createSilentCacheRequest(t,r);return yield this.silentCacheClient.acquireToken(o)}catch(o){throw o}})}acquireTokenRedirect(e){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");let t=yield this.initializeNativeRequest(e),r={method:De.GetToken,request:t};try{let i=yield this.nativeMessageHandler.sendMessage(r);this.validateNativeResponse(i)}catch(i){if(i instanceof W&&i.isFatal())throw i}this.browserStorage.setTemporaryCache(M.NATIVE_REQUEST,JSON.stringify(t),!0);let o={apiId:x.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);yield this.navigationClient.navigateExternal(n,o)})}handleRedirectPromise(){return d(this,null,function*(){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;let e=this.browserStorage.getCachedNativeRequest();if(!e)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),null;let i=e,{prompt:t}=i,r=ur(i,["prompt"]);t&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(M.NATIVE_REQUEST));let o={method:De.GetToken,request:r},n=K.nowSeconds();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");let s=yield this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(s);let c=this.handleNativeResponse(s,r,n);return this.browserStorage.setInteractionInProgress(!1),c}catch(s){throw this.browserStorage.setInteractionInProgress(!1),s}})}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){return d(this,null,function*(){if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),e.account.id!==t.accountId)throw W.createUserSwitchError();let o=yield this.getDiscoveredAuthority(t.authority),n=o.getPreferredCache(),i=this.createIdTokenObj(e),s=this.createHomeAccountIdentifier(e,i),c=this.createAccountEntity(e,s,i,n),l=yield this.generateAuthenticationResult(e,t,i,c,o.canonicalAuthority,r);return this.cacheAccount(c),this.cacheNativeTokens(e,t,s,c,i,l.accessToken,l.tenantId,r),l})}createIdTokenObj(e){return new G(e.id_token||a.EMPTY_STRING,this.browserCrypto)}createHomeAccountIdentifier(e,t){return D.generateHomeAccountId(e.client_info||a.EMPTY_STRING,re.Default,this.logger,this.browserCrypto,t)}createAccountEntity(e,t,r,o){return D.createAccount(e.client_info,t,r,void 0,void 0,void 0,o,e.account.id)}generateScopes(e,t){return e.scope?L.fromString(e.scope):L.fromString(t.scope)}generatePopAccessToken(e,t){return d(this,null,function*(){if(t.tokenType===P.POP){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;let r=new fe(this.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw m.createKeyIdMissingError();return yield r.signPopToken(e.access_token,t.keyId,o)}else return e.access_token})}generateAuthenticationResult(e,t,r,o,n,i){return d(this,null,function*(){let s=this.addTelemetryFromNativeResponse(e),c=e.scope?L.fromString(e.scope):L.fromString(t.scope),l=e.account.properties||{},f=l.UID||r.claims.oid||r.claims.sub||a.EMPTY_STRING,_=l.TenantId||r.claims.tid||a.EMPTY_STRING,N=yield this.generatePopAccessToken(e,t),F=t.tokenType===P.POP?P.POP:P.BEARER;return{authority:n,uniqueId:f,tenantId:_,scopes:c.asArray(),account:o.getAccountInfo(),idToken:e.id_token,idTokenClaims:r.claims,accessToken:N,fromCache:s?this.isResponseFromCache(s):!1,expiresOn:new Date(Number(i+e.expires_in)*1e3),tokenType:F,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}})}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,o,n,i,s,c){let l=se.createIdTokenEntity(r,t.authority,e.id_token||a.EMPTY_STRING,t.clientId,n.claims.tid||a.EMPTY_STRING),f=t.tokenType===P.POP?a.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,_=c+f,N=this.generateScopes(e,t),F=ae.createAccessTokenEntity(r,t.authority,i,t.clientId,n?n.claims.tid||a.EMPTY_STRING:s,N.printScopes(),_,0,this.browserCrypto),V=new Qe(o,l,F);this.nativeStorageManager.saveCacheRecord(V)}addTelemetryFromNativeResponse(e){let t=this.getMATSFromResponse(e);return t?(this.performanceClient.addStaticFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw W.createUnexpectedError("Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");let t=e.authority||this.config.auth.authority;e.account&&(yield this.validateRequestAuthority(t,e.account));let r=new w(t);r.validateAsUri();let l=e,{scopes:o}=l,n=ur(l,["scopes"]),i=new L(o||[]);i.appendScopes(ve);let s=()=>{switch(this.apiId){case x.ssoSilent:case x.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),$.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case $.NONE:case $.CONSENT:case $.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),h.createNativePromptParameterNotSupportedError()}},c=b(T({},n),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:s(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:b(T(T({},e.extraQueryParameters),e.tokenQueryParameters),{telemetry:it.MATS_TELEMETRY}),extendedExpiryToken:!1});if(e.authenticationScheme===P.POP){let f={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},N=yield new fe(this.browserCrypto).generateCnf(f);c.reqCnf=N.reqCnfHash,c.keyId=N.kid}return c})}};var de=class{constructor(e,t,r,o,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(u.NativeMessageHandlerHandshake),this.crypto=o}sendMessage(e){return d(this,null,function*(){this.logger.trace("NativeMessageHandler - sendMessage called.");let t={channel:it.CHANNEL_ID,extensionId:this.extensionId,responseId:this.crypto.createNewGuid(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((r,o)=>{this.resolvers.set(t.responseId,{resolve:r,reject:o})})})}static createProvider(e,t,r,o){return d(this,null,function*(){e.trace("NativeMessageHandler - createProvider called.");try{let n=new de(e,t,r,o,it.PREFERRED_EXTENSION_ID);return yield n.sendHandshakeRequest(),n}catch{let i=new de(e,t,r,o);return yield i.sendHandshakeRequest(),i}})}sendHandshakeRequest(){return d(this,null,function*(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);let e={channel:it.CHANNEL_ID,extensionId:this.extensionId,responseId:this.crypto.createNewGuid(),body:{method:De.HandshakeRequest}};return this.handshakeEvent.addStaticFields({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.endMeasurement({extensionHandshakeTimedOut:!0,success:!1}),r(h.createNativeHandshakeTimeoutError()),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;let t=e.data;if(!(!t.channel||t.channel!==it.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===De.HandshakeRequest){let r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.endMeasurement({success:!1,extensionInstalled:!1}),r.reject(h.createNativeExtensionNotInstalledError())}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");let t=e.data,r=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{let n=t.body.method;if(n===De.Response){if(!r)return;let i=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(i)}`),i.status!=="Success")r.reject(W.createError(i.code,i.description,i.ext));else if(i.result)i.result.code&&i.result.description?r.reject(W.createError(i.result.code,i.result.description,i.result.ext)):r.resolve(i.result);else throw y.createUnexpectedError("Event does not contain result.");this.resolvers.delete(t.responseId)}else if(n===De.HandshakeResponse){if(!o){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.endMeasurement({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(n){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${n}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(n):o&&o.reject(n)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,o){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(o)switch(o){case P.BEARER:case P.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}};var Ve=class{constructor(e,t,r,o,n){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=n}handleCodeResponseFromHash(e,t,r,o){return d(this,null,function*(){if(this.performanceClient.addQueueMeasurement(u.HandleCodeResponseFromHash,this.authCodeRequest.correlationId),this.logger.verbose("InteractionHandler.handleCodeResponse called"),g.isEmpty(e))throw h.createEmptyHashError();let n=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(n);if(!i)throw m.createStateNotFoundError("Cached State");let s;try{s=this.authModule.handleFragmentResponse(e,i)}catch(c){throw c instanceof ee&&c.subError===C.userCancelledError.code?h.createUserCancelledError():c}return this.performanceClient.setPreQueueTime(u.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.handleCodeResponseFromServer(s,t,r,o)})}handleCodeResponseFromServer(e,t,r,o,n=!0){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called");let i=this.browserStorage.generateStateKey(t),s=this.browserStorage.getTemporaryCache(i);if(!s)throw m.createStateNotFoundError("Cached State");let c=this.browserStorage.generateNonceKey(s),l=this.browserStorage.getTemporaryCache(c);if(this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(this.performanceClient.setPreQueueTime(u.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),yield this.updateTokenEndpointAuthority(e.cloud_instance_host_name,r,o)),n&&(e.nonce=l||void 0),e.state=s,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{let _=this.checkCcsCredentials();_&&(this.authCodeRequest.ccsCredential=_)}this.performanceClient.setPreQueueTime(u.AuthClientAcquireToken,this.authCodeRequest.correlationId);let f=yield this.authModule.acquireToken(this.authCodeRequest,e);return this.browserStorage.cleanRequestByState(t),f})}updateTokenEndpointAuthority(e,t,r){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId);let o=`https://${e}/${t.tenant}/`,n=yield ye.createDiscoveredInstance(o,r,this.browserStorage,t.options,this.logger,this.performanceClient,this.authCodeRequest.correlationId);this.authModule.updateAuthority(n)})}checkCcsCredentials(){let e=this.browserStorage.getTemporaryCache(M.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}};var tr=class extends me{constructor(e,t,r,o,n,i,s,c,l,f){super(e,t,r,o,n,i,s,l,f),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{let t=this.generatePopupName(e.scopes||ve,e.authority||this.config.auth.authority),r=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,r);{this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");let o=this.openSizedPopup("about:blank",t,r);return this.acquireTokenPopupAsync(e,t,r,o)}}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");let t=this.initializeLogoutRequest(e),r=this.generateLogoutPopupName(t),o=e&&e.authority,n=e&&e.mainWindowRedirectUri,i=e?.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o,void 0,n);{this.logger.verbose("asyncPopup set to false, opening popup");let s=this.openSizedPopup("about:blank",r,i);return this.logoutPopupAsync(t,r,i,o,s,n)}}catch(t){return Promise.reject(t)}}acquireTokenPopupAsync(e,t,r,o){return d(this,null,function*(){this.logger.verbose("acquireTokenPopupAsync called");let n=this.initializeServerTelemetryManager(x.acquireTokenPopup);this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId);let i=yield this.initializeAuthorizationRequest(e,I.Popup);this.browserStorage.updateCacheEntries(i.state,i.nonce,i.authority,i.loginHint||a.EMPTY_STRING,i.account||null);try{this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId);let s=yield this.initializeAuthorizationCodeRequest(i);this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,e.correlationId);let c=yield this.createAuthCodeClient(n,i.authority,i.azureCloudOptions);this.logger.verbose("Auth code client created");let l=de.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme),f;l&&(f=this.performanceClient.startMeasurement(u.FetchAccountIdWithNativeBroker,e.correlationId));let _=yield c.getAuthCodeUrl(b(T({},i),{nativeBroker:l})),N=new Ve(c,this.browserStorage,s,this.logger,this.performanceClient),F={popup:o,popupName:t,popupWindowAttributes:r},V=this.initiateAuthRequest(_,F);this.eventHandler.emitEvent(v.POPUP_OPENED,I.Popup,{popupWindow:V},null);let _e=yield this.monitorPopupForHash(V),H=w.getDeserializedHash(_e),pe=this.validateAndExtractStateFromHash(H,I.Popup,i.correlationId);if(ne.removeThrottle(this.browserStorage,this.config.auth.clientId,s),H.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),f&&f.endMeasurement({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw h.createNativeConnectionNotEstablishedError();let dt=new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,H.accountId,this.nativeStorage,i.correlationId),{userRequestState:hr}=Q.parseRequestState(this.browserCrypto,pe);return dt.acquireToken(b(T({},i),{state:hr,prompt:void 0})).finally(()=>{this.browserStorage.cleanRequestByState(pe)})}return yield N.handleCodeResponseFromHash(_e,pe,c.authority,this.networkClient)}catch(s){throw o&&o.close(),s instanceof y&&(s.setCorrelationId(this.correlationId),n.cacheFailedRequest(s)),this.browserStorage.cleanRequestByState(i.state),s}})}logoutPopupAsync(e,t,r,o,n,i){return d(this,null,function*(){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(v.LOGOUT_START,I.Popup,e);let s=this.initializeServerTelemetryManager(x.logoutPopup);try{yield this.clearCacheOnLogout(e.account),this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,e.correlationId);let c=yield this.createAuthCodeClient(s,o);this.logger.verbose("Auth code client created");let l=c.getLogoutUri(e);this.eventHandler.emitEvent(v.LOGOUT_SUCCESS,I.Popup,e);let f=this.openPopup(l,{popupName:t,popupWindowAttributes:r,popup:n});if(this.eventHandler.emitEvent(v.POPUP_OPENED,I.Popup,{popupWindow:f},null),yield this.waitForLogoutPopup(f),i){let _={apiId:x.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},N=w.getAbsoluteUrl(i,O.getCurrentUri());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${N}`),this.navigationClient.navigateInternal(N,_)}else this.logger.verbose("No main window navigation requested")}catch(c){throw n&&n.close(),c instanceof y&&(c.setCorrelationId(this.correlationId),s.cacheFailedRequest(c)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(v.LOGOUT_FAILURE,I.Popup,null,c),this.eventHandler.emitEvent(v.LOGOUT_END,I.Popup),c}this.eventHandler.emitEvent(v.LOGOUT_END,I.Popup)})}initiateAuthRequest(e,t){if(g.isEmpty(e))throw this.logger.error("Navigate url is empty"),h.createEmptyNavigationUriError();return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t)}monitorPopupForHash(e){return new Promise((t,r)=>{let o=this.config.system.windowHashTimeout/this.config.system.pollIntervalMilliseconds,n=0;this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");let i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),this.cleanPopup(),clearInterval(i),r(h.createUserCancelledError());return}let s=a.EMPTY_STRING,c=a.EMPTY_STRING;try{s=e.location.href,c=e.location.hash}catch{}g.isEmpty(s)||s==="about:blank"||(this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n++,c?(this.logger.verbose("PopupHandler.monitorPopupForHash - found hash in url"),clearInterval(i),this.cleanPopup(e),w.hashContainsKnownProperties(c)?(this.logger.verbose("PopupHandler.monitorPopupForHash - hash contains known properties, returning."),t(c)):(this.logger.error("PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely."),this.logger.errorPii(`PopupHandler.monitorPopupForHash - hash found: ${c}`),r(h.createHashDoesNotContainKnownPropertiesError()))):n>o&&(this.logger.error("PopupHandler.monitorPopupForHash - unable to find hash in url, timing out"),clearInterval(i),r(h.createMonitorPopupTimeoutError())))},this.config.system.pollIntervalMilliseconds)})}waitForLogoutPopup(e){return new Promise(t=>{this.logger.verbose("PopupHandler.waitForLogoutPopup - polling started");let r=setInterval(()=>{e.closed&&(this.logger.error("PopupHandler.waitForLogoutPopup - window closed"),this.cleanPopup(),clearInterval(r),t());let o=a.EMPTY_STRING;try{o=e.location.href}catch{}g.isEmpty(o)||o==="about:blank"||(this.logger.verbose("PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing."),clearInterval(r),this.cleanPopup(e),t())},this.config.system.pollIntervalMilliseconds)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!r)throw h.createEmptyWindowCreatedError();return r.focus&&r.focus(),this.currentWindow=r,window.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),this.browserStorage.setInteractionInProgress(!1),h.createPopupWindowError(r.toString())}}openSizedPopup(e,t,r){let o=window.screenLeft?window.screenLeft:window.screenX,n=window.screenTop?window.screenTop:window.screenY,i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=r.popupSize?.width,l=r.popupSize?.height,f=r.popupPosition?.top,_=r.popupPosition?.left;return(!c||c<0||c>i)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=oe.POPUP_WIDTH),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=oe.POPUP_HEIGHT),(!f||f<0||f>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),f=Math.max(0,s/2-oe.POPUP_HEIGHT/2+n)),(!_||_<0||_>i)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),_=Math.max(0,i/2-oe.POPUP_WIDTH/2+o)),window.open(e,t,`width=${c}, height=${l}, top=${f}, left=${_}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(I.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${oe.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){let t=e.account&&e.account.homeAccountId;return`${oe.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}};var Ht=class extends Ve{constructor(e,t,r,o,n,i){super(e,t,r,o,i),this.browserCrypto=n}initiateAuthRequest(e,t){return d(this,null,function*(){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),g.isEmpty(e))throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),h.createEmptyNavigationUriError();{t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(M.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(M.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);let r={apiId:x.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),yield t.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),yield t.navigationClient.navigateExternal(e,r);return}}})}handleCodeResponseFromHash(e,t,r,o){return d(this,null,function*(){if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),g.isEmpty(e))throw h.createEmptyHashError();this.browserStorage.setInteractionInProgress(!1);let n=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(n);if(!i)throw m.createStateNotFoundError("Cached State");let s;try{s=this.authModule.handleFragmentResponse(e,i)}catch(_){throw _ instanceof ee&&_.subError===C.userCancelledError.code?h.createUserCancelledError():_}let c=this.browserStorage.generateNonceKey(i),l=this.browserStorage.getTemporaryCache(c);if(this.authCodeRequest.code=s.code,s.cloud_instance_host_name&&(yield this.updateTokenEndpointAuthority(s.cloud_instance_host_name,r,o)),s.nonce=l||void 0,s.state=i,s.client_info)this.authCodeRequest.clientInfo=s.client_info;else{let _=this.checkCcsCredentials();_&&(this.authCodeRequest.ccsCredential=_)}let f=yield this.authModule.acquireToken(this.authCodeRequest,s);return this.browserStorage.cleanRequestByState(t),f})}};var rr=class extends me{constructor(e,t,r,o,n,i,s,c,l,f){super(e,t,r,o,n,i,s,l,f),this.nativeStorage=c}acquireToken(e){return d(this,null,function*(){this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId);let t=yield this.initializeAuthorizationRequest(e,I.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||a.EMPTY_STRING,t.account||null);let r=this.initializeServerTelemetryManager(x.acquireTokenRedirect),o=n=>{n.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(v.RESTORE_FROM_BFCACHE,I.Redirect))};try{this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId);let n=yield this.initializeAuthorizationCodeRequest(t);this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,e.correlationId);let i=yield this.createAuthCodeClient(r,t.authority,t.azureCloudOptions);this.logger.verbose("Auth code client created");let s=new Ht(i,this.browserStorage,n,this.logger,this.browserCrypto,this.performanceClient),c=yield i.getAuthCodeUrl(b(T({},t),{nativeBroker:de.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)})),l=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${l}`),window.addEventListener("pageshow",o),yield s.initiateAuthRequest(c,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate})}catch(n){throw n instanceof y&&(n.setCorrelationId(this.correlationId),r.cacheFailedRequest(n)),window.removeEventListener("pageshow",o),this.browserStorage.cleanRequestByState(t.state),n}})}handleRedirectPromise(e){return d(this,null,function*(){let t=this.initializeServerTelemetryManager(x.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;let r=this.getRedirectResponseHash(e||window.location.hash);if(!r)return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(I.Redirect),null;let o;try{let c=w.getDeserializedHash(r);o=this.validateAndExtractStateFromHash(c,I.Redirect),this.logger.verbose("State extracted from hash")}catch(c){return this.logger.info(`handleRedirectPromise was unable to extract state due to: ${c}`),this.browserStorage.cleanRequestByInteractionType(I.Redirect),null}let n=this.browserStorage.getTemporaryCache(M.ORIGIN_URI,!0)||a.EMPTY_STRING,i=w.removeHashFromUrl(n),s=w.removeHashFromUrl(window.location.href);if(i===s&&this.config.auth.navigateToLoginRequestUrl){this.logger.verbose("Current page is loginRequestUrl, handling hash");let c=yield this.handleHash(r,o,t);return n.indexOf("#")>-1&&O.replaceHash(n),c}else if(this.config.auth.navigateToLoginRequestUrl){if(!O.isInIframe()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(M.URL_HASH,r,!0);let c={apiId:x.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},l=!0;if(!n||n==="null"){let f=O.getHomepage();this.browserStorage.setTemporaryCache(M.ORIGIN_URI,f,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),l=yield this.navigationClient.navigateInternal(f,c)}else this.logger.verbose(`Navigating to loginRequestUrl: ${n}`),l=yield this.navigationClient.navigateInternal(n,c);if(!l)return this.handleHash(r,o,t)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),this.handleHash(r,o,t);return null}catch(r){throw r instanceof y&&(r.setCorrelationId(this.correlationId),t.cacheFailedRequest(r)),this.browserStorage.cleanRequestByInteractionType(I.Redirect),r}})}getRedirectResponseHash(e){if(this.logger.verbose("getRedirectResponseHash called"),w.hashContainsKnownProperties(e))return O.clearHash(window),this.logger.verbose("Hash contains known properties, returning response hash"),e;let r=this.browserStorage.getTemporaryCache(M.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(M.URL_HASH)),this.logger.verbose("Hash does not contain known properties, returning cached hash"),r}handleHash(e,t,r){return d(this,null,function*(){let o=this.browserStorage.getCachedRequest(t,this.browserCrypto);this.logger.verbose("handleHash called, retrieved cached request");let n=w.getDeserializedHash(e);if(n.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw h.createNativeConnectionNotEstablishedError();let l=new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,n.accountId,this.nativeStorage,o.correlationId),{userRequestState:f}=Q.parseRequestState(this.browserCrypto,t);return l.acquireToken(b(T({},o),{state:f,prompt:void 0})).finally(()=>{this.browserStorage.cleanRequestByState(t)})}let i=this.browserStorage.getCachedAuthority(t);if(!i)throw h.createNoCachedAuthorityError();this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,o.correlationId);let s=yield this.createAuthCodeClient(r,i);return this.logger.verbose("Auth code client created"),ne.removeThrottle(this.browserStorage,this.config.auth.clientId,o),yield new Ht(s,this.browserStorage,o,this.logger,this.browserCrypto,this.performanceClient).handleCodeResponseFromHash(e,t,s.authority,this.networkClient)})}logout(e){return d(this,null,function*(){this.logger.verbose("logoutRedirect called");let t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(x.logout);try{this.eventHandler.emitEvent(v.LOGOUT_START,I.Redirect,e),yield this.clearCacheOnLogout(t.account);let o={apiId:x.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1};this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,t.correlationId);let n=yield this.createAuthCodeClient(r,e&&e.authority);this.logger.verbose("Auth code client created");let i=n.getLogoutUri(t);if(this.eventHandler.emitEvent(v.LOGOUT_SUCCESS,I.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(i)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),yield this.navigationClient.navigateExternal(i,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),yield this.navigationClient.navigateExternal(i,o);return}}catch(o){throw o instanceof y&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(v.LOGOUT_FAILURE,I.Redirect,null,o),this.eventHandler.emitEvent(v.LOGOUT_END,I.Redirect),o}this.eventHandler.emitEvent(v.LOGOUT_END,I.Redirect)})}getRedirectStartPage(e){let t=e||window.location.href;return w.getAbsoluteUrl(t,O.getCurrentUri())}};var ct=class{navigateInternal(e,t){return ct.defaultNavigateWindow(e,t)}navigateExternal(e,t){return ct.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}};var eo=6e4,or=6e3,to=3e4,ro=2e3;function Mh({auth:p,cache:e,system:t,telemetry:r},o){let n={clientId:a.EMPTY_STRING,authority:`${a.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:a.EMPTY_STRING,authorityMetadata:a.EMPTY_STRING,redirectUri:a.EMPTY_STRING,postLogoutRedirectUri:a.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:ut.AAD,azureCloudOptions:{azureCloudInstance:Je.None,tenant:a.EMPTY_STRING},skipAuthorityMetadataCache:!1},i={cacheLocation:Y.SessionStorage,temporaryCacheLocation:Y.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Y.LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:U.Info,piiLoggingEnabled:!1},c=b(T({},qt),{loggerOptions:s,networkClient:o?O.getBrowserNetworkClient():Er,navigationClient:new ct,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||eo,iframeHashTimeout:t?.loadFrameTimeout||or,navigateFrameWait:o&&O.detectIEOrEdge()?500:0,redirectNavigationTimeout:to,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!0,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||ro,pollIntervalMilliseconds:oe.DEFAULT_POLL_INTERVAL_MS}),l=b(T({},t),{loggerOptions:t?.loggerOptions||s}),f={application:{appName:a.EMPTY_STRING,appVersion:a.EMPTY_STRING}};return{auth:T(T({},n),p),cache:T(T({},i),e),system:T(T({},c),l),telemetry:T(T({},f),r)}}var It=class extends Ve{constructor(e,t,r,o,n,i){super(e,t,r,o,i),this.navigateFrameWait=n.navigateFrameWait,this.pollIntervalMilliseconds=n.pollIntervalMilliseconds}initiateAuthRequest(e){return d(this,null,function*(){if(this.performanceClient.addQueueMeasurement(u.SilentHandlerInitiateAuthRequest,this.authCodeRequest.correlationId),g.isEmpty(e))throw this.logger.info("Navigate url is empty"),h.createEmptyNavigationUriError();return this.navigateFrameWait?(this.performanceClient.setPreQueueTime(u.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),yield this.loadFrame(e)):this.loadFrameSync(e)})}monitorIframeForHash(e,t){return this.performanceClient.addQueueMeasurement(u.SilentHandlerMonitorIframeForHash,this.authCodeRequest.correlationId),new Promise((r,o)=>{t<or&&this.logger.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (${or}ms). This may result in timeouts.`);let i=window.performance.now()+t,s=setInterval(()=>{if(window.performance.now()>i){this.removeHiddenIframe(e),clearInterval(s),o(h.createMonitorIframeTimeoutError());return}let c=a.EMPTY_STRING,l=e.contentWindow;try{c=l?l.location.href:a.EMPTY_STRING}catch{}if(g.isEmpty(c)||c==="about:blank")return;let f=l?l.location.hash:a.EMPTY_STRING;if(f)if(w.hashContainsKnownProperties(f)){this.removeHiddenIframe(e),clearInterval(s),r(f);return}else{this.logger.error("SilentHandler:monitorIFrameForHash - a hash is present in the iframe but it does not contain known properties. It's likely that the hash has been replaced by code running on the redirectUri page."),this.logger.errorPii(`SilentHandler:monitorIFrameForHash - the url detected in the iframe is: ${c}`),this.removeHiddenIframe(e),clearInterval(s),o(h.createHashDoesNotContainKnownPropertiesError());return}else{this.logger.error("SilentHandler:monitorIFrameForHash - the request has returned to the redirectUri but a hash is not present in the iframe. It's likely that the hash has been removed or the page has been redirected by code running on the redirectUri page."),this.logger.errorPii(`SilentHandler:monitorIFrameForHash - the url detected in the iframe is: ${c}`),this.removeHiddenIframe(e),clearInterval(s),o(h.createEmptyHashError());return}},this.pollIntervalMilliseconds)})}loadFrame(e){return this.performanceClient.addQueueMeasurement(u.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),new Promise((t,r)=>{let o=this.createHiddenIframe();setTimeout(()=>{if(!o){r("Unable to load iframe");return}o.src=e,t(o)},this.navigateFrameWait)})}loadFrameSync(e){let t=this.createHiddenIframe();return t.src=e,t}createHiddenIframe(){let e=document.createElement("iframe");return e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.getElementsByTagName("body")[0].appendChild(e),e}removeHiddenIframe(e){document.body===e.parentNode&&document.body.removeChild(e)}};var nr=class extends me{constructor(e,t,r,o,n,i,s,c,l,f,_){super(e,t,r,o,n,i,c,f,_),this.apiId=s,this.nativeStorage=l}acquireToken(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentIframeClientAcquireToken,e.correlationId),this.logger.verbose("acquireTokenByIframe called");let t=this.performanceClient.startMeasurement(u.SilentIframeClientAcquireToken,e.correlationId);if(g.isEmpty(e.loginHint)&&g.isEmpty(e.sid)&&(!e.account||g.isEmpty(e.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),e.prompt&&e.prompt!==$.NONE&&e.prompt!==$.NO_SESSION)throw t.endMeasurement({success:!1}),h.createSilentPromptValueError(e.prompt);this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId);let r=yield this.initializeAuthorizationRequest(b(T({},e),{prompt:e.prompt||$.NONE}),I.Silent);this.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||a.EMPTY_STRING,r.account||null);let o=this.initializeServerTelemetryManager(this.apiId);try{this.performanceClient.setPreQueueTime(u.StandardInteractionClientCreateAuthCodeClient,e.correlationId);let n=yield this.createAuthCodeClient(o,r.authority,r.azureCloudOptions);return this.logger.verbose("Auth code client created"),this.performanceClient.setPreQueueTime(u.SilentIframeClientTokenHelper,e.correlationId),yield this.silentTokenHelper(n,r).then(i=>(t.endMeasurement({success:!0,fromCache:!1,requestId:i.requestId}),i))}catch(n){throw n instanceof y&&(n.setCorrelationId(this.correlationId),o.cacheFailedRequest(n)),this.browserStorage.cleanRequestByState(r.state),t.endMeasurement({errorCode:n instanceof y&&n.errorCode||void 0,subErrorCode:n instanceof y&&n.subError||void 0,success:!1}),n}})}logout(){return Promise.reject(h.createSilentLogoutUnsupportedError())}silentTokenHelper(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentIframeClientTokenHelper,t.correlationId),this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId);let r=yield this.initializeAuthorizationCodeRequest(t);this.performanceClient.setPreQueueTime(u.GetAuthCodeUrl,t.correlationId);let o=yield e.getAuthCodeUrl(b(T({},t),{nativeBroker:de.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)})),n=new It(e,this.browserStorage,r,this.logger,this.config.system,this.performanceClient);this.performanceClient.setPreQueueTime(u.SilentHandlerInitiateAuthRequest,t.correlationId);let i=yield n.initiateAuthRequest(o);this.performanceClient.setPreQueueTime(u.SilentHandlerMonitorIframeForHash,t.correlationId);let s=yield n.monitorIframeForHash(i,this.config.system.iframeHashTimeout),c=w.getDeserializedHash(s),l=this.validateAndExtractStateFromHash(c,I.Silent,r.correlationId);if(c.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw h.createNativeConnectionNotEstablishedError();let f=new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,c.accountId,this.browserStorage,this.correlationId),{userRequestState:_}=Q.parseRequestState(this.browserCrypto,l);return f.acquireToken(b(T({},t),{state:_,prompt:t.prompt||$.NONE})).finally(()=>{this.browserStorage.cleanRequestByState(l)})}return this.performanceClient.setPreQueueTime(u.HandleCodeResponseFromHash,t.correlationId),n.handleCodeResponseFromHash(s,l,e.authority,this.networkClient)})}};var ir=class extends me{acquireToken(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentRefreshClientAcquireToken,e.correlationId),this.performanceClient.setPreQueueTime(u.InitializeBaseRequest,e.correlationId);let t=T(T({},e),yield this.initializeBaseRequest(e,e.account)),r=this.performanceClient.startMeasurement(u.SilentRefreshClientAcquireToken,t.correlationId),o=this.initializeServerTelemetryManager(x.acquireTokenSilent_silentFlow),n=yield this.createRefreshTokenClient(o,t.authority,t.azureCloudOptions);return this.logger.verbose("Refresh token client created"),this.performanceClient.setPreQueueTime(u.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),n.acquireTokenByRefreshToken(t).then(i=>i).then(i=>(r.endMeasurement({success:!0,fromCache:i.fromCache,requestId:i.requestId}),i)).catch(i=>{throw i.setCorrelationId(this.correlationId),o.cacheFailedRequest(i),r.endMeasurement({errorCode:i.errorCode,subErrorCode:i.subError,success:!1}),i})})}logout(){return Promise.reject(h.createSilentLogoutUnsupportedError())}createRefreshTokenClient(e,t,r){return d(this,null,function*(){this.performanceClient.setPreQueueTime(u.StandardInteractionClientGetClientConfiguration,this.correlationId);let o=yield this.getClientConfiguration(e,t,r);return new rt(o,this.performanceClient)})}};var sr=class{constructor(e,t,r,o){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=o}loadExternalTokens(e,t,r){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw h.createUnableToLoadTokenError("Please ensure server response includes id token.");let o=new G(t.id_token,this.cryptoObj),n,i;if(e.account){let s=this.loadAccount(o,e.account.environment,void 0,void 0,e.account.homeAccountId);n=new Qe(s,this.loadIdToken(o,s.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,s.homeAccountId,e.account.environment,e.account.tenantId,r),this.loadRefreshToken(e,t,s.homeAccountId,e.account.environment))}else if(e.authority){let s=B.generateAuthority(e.authority,e.azureCloudOptions),c={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};if(i=new B(s,this.config.system.networkClient,this.storage,c,this.logger),r.clientInfo){this.logger.trace("TokenCache - homeAccountId from options");let l=this.loadAccount(o,i.hostnameAndPort,r.clientInfo,i.authorityType);n=new Qe(l,this.loadIdToken(o,l.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,l.homeAccountId,i.hostnameAndPort,i.tenant,r),this.loadRefreshToken(e,t,l.homeAccountId,i.hostnameAndPort))}else if(t.client_info){this.logger.trace("TokenCache - homeAccountId from response");let l=this.loadAccount(o,i.hostnameAndPort,t.client_info,i.authorityType);n=new Qe(l,this.loadIdToken(o,l.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,l.homeAccountId,i.hostnameAndPort,i.tenant,r),this.loadRefreshToken(e,t,l.homeAccountId,i.hostnameAndPort))}else throw h.createUnableToLoadTokenError("Please provide clientInfo in the response or options.")}else throw h.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");return this.generateAuthenticationResult(e,o,n,i)}loadAccount(e,t,r,o,n){let i;if(n?i=n:o!==void 0&&r&&(i=D.generateHomeAccountId(r,o,this.logger,this.cryptoObj,e)),!i)throw h.createUnableToLoadTokenError("Unexpected missing homeAccountId");let s=r?D.createAccount(r,i,e,void 0,void 0,void 0,t):D.createGenericAccount(i,e,void 0,void 0,void 0,t);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading account"),this.storage.setAccount(s),s;throw h.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")}loadIdToken(e,t,r,o){let n=se.createIdTokenEntity(t,r,e.rawToken,this.config.auth.clientId,o);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(n),n;throw h.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")}loadAccessToken(e,t,r,o,n,i){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw h.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!i.extendedExpiresOn)throw h.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");let s=new L(e.scopes).printScopes(),c=i.expiresOn||t.expires_in+new Date().getTime()/1e3,l=i.extendedExpiresOn,f=ae.createAccessTokenEntity(r,o,t.access_token,this.config.auth.clientId,n,s,c,l,this.cryptoObj);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(f),f;throw h.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")}loadRefreshToken(e,t,r,o){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;let n=he.createRefreshTokenEntity(r,o,t.refresh_token,this.config.auth.clientId);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(n),n;throw h.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")}generateAuthenticationResult(e,t,r,o){let n=a.EMPTY_STRING,i=[],s=null,c;r?.accessToken&&(n=r.accessToken.secret,i=L.fromString(r.accessToken.target).asArray(),s=new Date(Number(r.accessToken.expiresOn)*1e3),c=new Date(Number(r.accessToken.extendedExpiresOn)*1e3));let l=t?.claims.oid||t?.claims.sub||a.EMPTY_STRING,f=t?.claims.tid||a.EMPTY_STRING;return{authority:o?o.canonicalAuthority:a.EMPTY_STRING,uniqueId:l,tenantId:f,scopes:i,account:r.account.getAccountInfo(),idToken:t?t.rawToken:a.EMPTY_STRING,idTokenClaims:t?t.claims:{},accessToken:n,fromCache:!0,expiresOn:s,correlationId:e.correlationId||a.EMPTY_STRING,requestId:a.EMPTY_STRING,extExpiresOn:c,familyId:a.EMPTY_STRING,tokenType:r?.accessToken?.tokenType||a.EMPTY_STRING,state:a.EMPTY_STRING,cloudGraphHostName:r?.account?.cloudGraphHostName||a.EMPTY_STRING,msGraphHost:r?.account?.msGraphHost||a.EMPTY_STRING,code:void 0,fromNativeBroker:!1}}};var ar=class extends tt{constructor(e){super(e),this.includeRedirectUri=!1}};var cr=class extends me{constructor(e,t,r,o,n,i,s,c,l,f){super(e,t,r,o,n,i,c,l,f),this.apiId=s}acquireToken(e){return d(this,null,function*(){if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),!e.code)throw h.createAuthCodeRequiredError();this.performanceClient.setPreQueueTime(u.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId);let t=yield this.initializeAuthorizationRequest(e,I.Silent);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||a.EMPTY_STRING,t.account||null);let r=this.initializeServerTelemetryManager(this.apiId);try{let o=b(T({},t),{code:e.code});this.performanceClient.setPreQueueTime(u.StandardInteractionClientGetClientConfiguration,e.correlationId);let n=yield this.getClientConfiguration(r,t.authority),i=new ar(n);return this.logger.verbose("Auth code client created"),new It(i,this.browserStorage,o,this.logger,this.config.system,this.performanceClient).handleCodeResponseFromServer({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t.state,i.authority,this.networkClient,!1)}catch(o){throw o instanceof y&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.browserStorage.cleanRequestByState(t.state),o}})}logout(){return Promise.reject(h.createSilentLogoutUnsupportedError())}};var le=class{constructor(e,t){this.correlationId=t,this.measureName=le.makeMeasureName(e,t),this.startMark=le.makeStartMark(e,t),this.endMark=le.makeEndMark(e,t)}static makeMeasureName(e,t){return`msal.measure.${e}.${t}`}static makeStartMark(e,t){return`msal.start.${e}.${t}`}static makeEndMark(e,t){return`msal.end.${e}.${t}`}static supportsBrowserPerformance(){return typeof window<"u"&&typeof window.performance<"u"&&typeof window.performance.mark=="function"&&typeof window.performance.measure=="function"&&typeof window.performance.clearMarks=="function"&&typeof window.performance.clearMeasures=="function"&&typeof window.performance.getEntriesByName=="function"}static flushMeasurements(e,t){if(le.supportsBrowserPerformance())try{t.forEach(r=>{let o=le.makeMeasureName(r.name,e);window.performance.getEntriesByName(o,"measure").length>0&&(window.performance.clearMeasures(o),window.performance.clearMarks(le.makeStartMark(o,e)),window.performance.clearMarks(le.makeEndMark(o,e)))})}catch{}}startMeasurement(){if(le.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch{}}endMeasurement(){if(le.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch{}}flushMeasurement(){if(le.supportsBrowserPerformance())try{let e=window.performance.getEntriesByName(this.measureName,"measure");if(e.length>0){let t=e[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),t}}catch{}return null}};var dr=class extends nt{constructor(e,t,r,o,n,i){super(e,t,r,o,n,i),this.browserCrypto=new ft(this.logger),this.guidGenerator=new pt(this.browserCrypto)}startPerformanceMeasurement(e,t){return new le(e,t)}generateId(){return this.guidGenerator.generateGuid()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){let t=this.eventsByCorrelationId.get(e.event.correlationId),r=t&&t.eventId===e.event.eventId,o=[];r&&t?.incompleteSubMeasurements&&t.incompleteSubMeasurements.forEach(n=>{o.push(T({},n))}),o.length>0&&le.flushMeasurements(e.event.correlationId,o)}supportsBrowserPerformanceNow(){return typeof window<"u"&&typeof window.performance<"u"&&typeof window.performance.now=="function"}startMeasurement(e,t){let r=this.getPageVisibility(),o=super.startMeasurement(e,t);return b(T({},o),{endMeasurement:n=>{let i=o.endMeasurement(T({startPageVisibility:r,endPageVisibility:this.getPageVisibility()},n));return this.deleteIncompleteSubMeasurements(o),i},discardMeasurement:()=>{o.discardMeasurement(),this.deleteIncompleteSubMeasurements(o),o.measurement.flushMeasurement()}})}setPreQueueTime(e,t){if(!this.supportsBrowserPerformanceNow()){this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);return}if(!t){this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);return}let r=this.preQueueTimeByCorrelationId.get(t);r&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${r.name} found`,t),this.addQueueMeasurement(r.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,r,o){if(!this.supportsBrowserPerformanceNow()){this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);return}if(!t){this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);return}let n=super.getPreQueueTime(e,t);if(!n)return;let i=window.performance.now(),s=r||super.calculateQueuedTime(n,i);return super.addQueueMeasurement(e,t,s,o)}};var lr=class{constructor(e){this.atsAsyncMeasurement=void 0,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new dr(this.config.auth.clientId,this.config.auth.authority,this.logger,_r,at,this.config.telemetry.application):new Nt(this.config.auth.clientId,this.config.auth.authority,this.logger,_r,at,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new Dr(this.logger,this.performanceClient):Ge,this.eventHandler=new er(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Le(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):xr(this.config.auth.clientId,this.logger);let t={cacheLocation:Y.MemoryStorage,temporaryCacheLocation:Y.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Le(this.config.auth.clientId,t,this.browserCrypto,this.logger),this.tokenCache=new sr(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static createController(e){return d(this,null,function*(){let t=new lr(e);return t.initialize(),t})}trackPageVisibility(){this.atsAsyncMeasurement&&(this.logger.info("Perf: Visibility change detected"),this.atsAsyncMeasurement.increment({visibilityChangeCount:1}))}initialize(){return d(this,null,function*(){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}let e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(u.InitializeClientApplication);if(this.eventHandler.emitEvent(v.INITIALIZE_START),e)try{this.nativeExtensionProvider=yield de.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient,this.browserCrypto)}catch(r){this.logger.verbose(r)}this.initialized=!0,this.eventHandler.emitEvent(v.INITIALIZE_END),t.endMeasurement({allowNativeBroker:e,success:!0})})}handleRedirectPromise(e){return d(this,null,function*(){this.logger.verbose("handleRedirectPromise called"),O.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized);let t=this.getAllAccounts();if(this.isBrowserEnvironment){let r=e||a.EMPTY_STRING,o=this.redirectResponse.get(r);if(typeof o>"u"){this.eventHandler.emitEvent(v.HANDLE_REDIRECT_START,I.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise");let n=this.browserStorage.getCachedNativeRequest(),i;if(n&&de.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e)this.logger.trace("handleRedirectPromise - acquiring token from native platform"),i=new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,n.accountId,this.nativeInternalStorage,n.correlationId).handleRedirectPromise();else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");let s=this.browserStorage.getTemporaryCache(M.CORRELATION_ID,!0)||a.EMPTY_STRING;i=this.createRedirectClient(s).handleRedirectPromise(e)}o=i.then(s=>(s&&(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(v.LOGIN_SUCCESS,I.Redirect,s),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_SUCCESS,I.Redirect,s),this.logger.verbose("handleRedirectResponse returned result, acquire token success"))),this.eventHandler.emitEvent(v.HANDLE_REDIRECT_END,I.Redirect),s)).catch(s=>{throw t.length>0?this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_FAILURE,I.Redirect,null,s):this.eventHandler.emitEvent(v.LOGIN_FAILURE,I.Redirect,null,s),this.eventHandler.emitEvent(v.HANDLE_REDIRECT_END,I.Redirect),s}),this.redirectResponse.set(r,o)}else this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call");return o}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})}acquireTokenRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(I.Redirect);let r=this.getAllAccounts().length>0;r?this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_START,I.Redirect,e):this.eventHandler.emitEvent(v.LOGIN_START,I.Redirect,e);let o;return this.nativeExtensionProvider&&this.canUseNative(e)?o=new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireTokenRedirect(e).catch(i=>{if(i instanceof W&&i.isFatal())return this.nativeExtensionProvider=void 0,this.createRedirectClient(e.correlationId).acquireToken(e);if(i instanceof z)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(e.correlationId).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),i}):o=this.createRedirectClient(e.correlationId).acquireToken(e),o.catch(n=>{throw r?this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_FAILURE,I.Redirect,null,n):this.eventHandler.emitEvent(v.LOGIN_FAILURE,I.Redirect,null,n),n})})}acquireTokenPopup(e){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenPopup,t);try{this.logger.verbose("acquireTokenPopup called",t),this.preflightBrowserEnvironmentCheck(I.Popup)}catch(i){return Promise.reject(i)}let o=this.getAllAccounts();o.length>0?this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_START,I.Popup,e):this.eventHandler.emitEvent(v.LOGIN_START,I.Popup,e);let n;return this.canUseNative(e)?n=this.acquireTokenNative(e,x.acquireTokenPopup).then(i=>(this.browserStorage.setInteractionInProgress(!1),r.endMeasurement({success:!0,isNativeBroker:!0,requestId:i.requestId}),i)).catch(i=>{if(i instanceof W&&i.isFatal())return this.nativeExtensionProvider=void 0,this.createPopupClient(e.correlationId).acquireToken(e);if(i instanceof z)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(e.correlationId).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),i}):n=this.createPopupClient(e.correlationId).acquireToken(e),n.then(i=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(v.LOGIN_SUCCESS,I.Popup,i):this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_SUCCESS,I.Popup,i),r.addStaticFields({accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length}),r.endMeasurement({success:!0,requestId:i.requestId}),i)).catch(i=>(o.length>0?this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_FAILURE,I.Popup,null,i):this.eventHandler.emitEvent(v.LOGIN_FAILURE,I.Popup,null,i),r.endMeasurement({errorCode:i.errorCode,subErrorCode:i.subError,success:!1}),Promise.reject(i)))}trackPageVisibilityWithMeasurement(){let e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e),r=b(T({},e),{prompt:e.prompt,correlationId:t});this.preflightBrowserEnvironmentCheck(I.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(u.SsoSilent,t),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(v.SSO_SILENT_START,I.Silent,r);let o;return this.canUseNative(r)?o=this.acquireTokenNative(r,x.ssoSilent).catch(n=>{if(n instanceof W&&n.isFatal())return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw n}):o=this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then(n=>(this.eventHandler.emitEvent(v.SSO_SILENT_SUCCESS,I.Silent,n),this.ssoSilentMeasurement?.addStaticFields({accessTokenSize:n.accessToken.length,idTokenSize:n.idToken.length}),this.ssoSilentMeasurement?.endMeasurement({success:!0,isNativeBroker:n.fromNativeBroker,requestId:n.requestId}),n)).catch(n=>{throw this.eventHandler.emitEvent(v.SSO_SILENT_FAILURE,I.Silent,null,n),this.ssoSilentMeasurement?.endMeasurement({errorCode:n.errorCode,subErrorCode:n.subError,success:!1}),n}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenByCode(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);this.preflightBrowserEnvironmentCheck(I.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_BY_CODE_START,I.Silent,e);let r=this.performanceClient.startMeasurement(u.AcquireTokenByCode,e.correlationId);try{if(e.code&&e.nativeAccountId)throw h.createSpaCodeAndNativeAccountIdPresentError();if(e.code){let o=e.code,n=this.hybridAuthCodeResponses.get(o);return n?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),r.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),n=this.acquireTokenByCodeAsync(b(T({},e),{correlationId:t})).then(i=>(this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_BY_CODE_SUCCESS,I.Silent,i),this.hybridAuthCodeResponses.delete(o),r.addStaticFields({accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length}),r.endMeasurement({success:!0,isNativeBroker:i.fromNativeBroker,requestId:i.requestId}),i)).catch(i=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_BY_CODE_FAILURE,I.Silent,null,i),r.endMeasurement({errorCode:i.errorCode,subErrorCode:i.subError,success:!1}),i}),this.hybridAuthCodeResponses.set(o,n)),n}else if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return this.acquireTokenNative(e,x.acquireTokenByCode,e.nativeAccountId).catch(o=>{throw o instanceof W&&o.isFatal()&&(this.nativeExtensionProvider=void 0),o});throw h.createUnableToAcquireTokenFromNativePlatformError()}else throw h.createAuthCodeOrNativeAccountIdRequiredError()}catch(o){throw this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_BY_CODE_FAILURE,I.Silent,null,o),r.endMeasurement({errorCode:o instanceof y&&o.errorCode||void 0,subErrorCode:o instanceof y&&o.subError||void 0,success:!1}),o}})}acquireTokenByCodeAsync(e){return d(this,null,function*(){return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(u.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),yield this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>(this.acquireTokenByCodeAsyncMeasurement?.endMeasurement({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o)).catch(o=>{throw this.acquireTokenByCodeAsyncMeasurement?.endMeasurement({errorCode:o.errorCode,subErrorCode:o.subError,success:!1}),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenFromCache(e,t,r){return d(this,null,function*(){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenFromCache,t.correlationId),r.cacheLookupPolicy){case Ce.Default:case Ce.AccessToken:case Ce.AccessTokenAndRefreshToken:return e.acquireToken(t);default:throw m.createRefreshRequiredError()}})}acquireTokenByRefreshToken(e,t){return d(this,null,function*(){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenByRefreshToken,e.correlationId),t.cacheLookupPolicy){case Ce.Default:case Ce.AccessTokenAndRefreshToken:case Ce.RefreshToken:case Ce.RefreshTokenAndNetwork:let r=this.createSilentRefreshClient(e.correlationId);return this.performanceClient.setPreQueueTime(u.SilentRefreshClientAcquireToken,e.correlationId),r.acquireToken(e);default:throw m.createRefreshRequiredError()}})}acquireTokenBySilentIframe(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.AcquireTokenBySilentIframe,e.correlationId);let t=this.createSilentIframeClient(e.correlationId);return this.performanceClient.setPreQueueTime(u.SilentIframeClientAcquireToken,e.correlationId),t.acquireToken(e)})}logout(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect(T({correlationId:t},e))})}logoutRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(I.Redirect),this.createRedirectClient(t).logout(e)})}logoutPopup(e){try{let t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(I.Popup),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}getAllAccounts(){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts():[]}getAccountByUsername(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;let t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)}getAccountByHomeId(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;let t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)}getAccountByLocalId(e){if(this.logger.trace("getAccountByLocalId called"),!e)return this.logger.warning("getAccountByLocalId: No localAccountId provided"),null;let t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e});return t?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)}setActiveAccount(e){this.browserStorage.setActiveAccount(e)}getActiveAccount(){return this.browserStorage.getActiveAccount()}preflightBrowserEnvironmentCheck(e,t=!1){if(this.logger.verbose("preflightBrowserEnvironmentCheck started"),O.blockNonBrowserEnvironment(this.isBrowserEnvironment),O.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),O.blockReloadInHiddenIframes(),O.blockAcquireTokenInPopups(),t||O.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===I.Redirect&&this.config.cache.cacheLocation===Y.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw ce.createInMemoryRedirectUnavailableError();(e===I.Redirect||e===I.Popup)&&this.preflightInteractiveRequest(!t)}preflightInteractiveRequest(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),O.blockReloadInHiddenIframes(),e&&this.browserStorage.setInteractionInProgress(!0)}acquireTokenNative(e,t,r){return d(this,null,function*(){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw h.createNativeConnectionNotEstablishedError();return new Ie(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)})}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!de.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case $.NONE:case $.CONSENT:case $.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){let t=e.account||this.browserStorage.getAccountInfoByHints(e.loginHint,e.sid)||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new tr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new rr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new nr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Tt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new ir(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new cr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,x.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}getBrowserStorage(){return this.browserStorage}getNativeInternalStorage(){return this.nativeInternalStorage}getBrowserCrypto(){return this.browserCrypto}isBrowserEnv(){return this.isBrowserEnvironment}getNativeExtensionProvider(){return this.nativeExtensionProvider}setNativeExtensionProvider(e){this.nativeExtensionProvider=e}getEventHandler(){return this.eventHandler}getNavigationClient(){return this.navigationClient}getRedirectResponse(){return this.redirectResponse}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():a.EMPTY_STRING}loginRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect(T({correlationId:t},e||Tr))})}loginPopup(e){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(T({correlationId:t},e||Tr))}acquireTokenSilent(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenSilent,t);r.addStaticFields({cacheLookupPolicy:e.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(I.Silent),this.logger.verbose("acquireTokenSilent called",t);let o=e.account||this.getActiveAccount();if(!o)throw h.createNoAccountError();let n={clientId:this.config.auth.clientId,authority:e.authority||a.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},i=JSON.stringify(n),s=this.activeSilentTokenRequests.get(i);if(typeof s>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t),this.performanceClient.setPreQueueTime(u.AcquireTokenSilentAsync,t);let c=this.acquireTokenSilentAsync(b(T({},e),{correlationId:t}),o).then(l=>(this.activeSilentTokenRequests.delete(i),r.addStaticFields({accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length}),r.endMeasurement({success:!0,fromCache:l.fromCache,isNativeBroker:l.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:l.requestId}),l)).catch(l=>{throw this.activeSilentTokenRequests.delete(i),r.endMeasurement({errorCode:l.errorCode,subErrorCode:l.subError,success:!1}),l});return this.activeSilentTokenRequests.set(i,c),c}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discardMeasurement(),s})}acquireTokenSilentAsync(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_START,I.Silent,e),this.atsAsyncMeasurement=this.performanceClient.startMeasurement(u.AcquireTokenSilentAsync,e.correlationId),this.atsAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility);let r;if(de.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId){this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform");let o=b(T({},e),{account:t});r=this.acquireTokenNative(o,x.acquireTokenSilent_silentFlow).catch(n=>d(this,null,function*(){if(n instanceof W&&n.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,this.createSilentIframeClient(e.correlationId).acquireToken(e);throw n}))}else{this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow");let o=this.createSilentCacheClient(e.correlationId);this.performanceClient.setPreQueueTime(u.InitializeSilentRequest,e.correlationId);let n=yield o.initializeSilentRequest(e,t),i=b(T({},e),{cacheLookupPolicy:e.cacheLookupPolicy||Ce.Default});this.performanceClient.setPreQueueTime(u.AcquireTokenFromCache,n.correlationId),r=this.acquireTokenFromCache(o,n,i).catch(s=>{if(i.cacheLookupPolicy===Ce.AccessToken)throw s;return O.blockReloadInHiddenIframes(),this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_NETWORK_START,I.Silent,n),this.performanceClient.setPreQueueTime(u.AcquireTokenByRefreshToken,n.correlationId),this.acquireTokenByRefreshToken(n,i).catch(c=>{let l=c instanceof ee,f=c instanceof z,_=c.errorCode===oe.INVALID_GRANT_ERROR;if((!l||!_||f||i.cacheLookupPolicy===Ce.AccessTokenAndRefreshToken||i.cacheLookupPolicy===Ce.RefreshToken)&&i.cacheLookupPolicy!==Ce.Skip)throw c;return this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",e.correlationId),this.performanceClient.setPreQueueTime(u.AcquireTokenBySilentIframe,n.correlationId),this.acquireTokenBySilentIframe(n)})})}return r.then(o=>(this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_SUCCESS,I.Silent,o),this.atsAsyncMeasurement?.endMeasurement({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o)).catch(o=>{throw this.eventHandler.emitEvent(v.ACQUIRE_TOKEN_FAILURE,I.Silent,null,o),this.atsAsyncMeasurement?.endMeasurement({errorCode:o.errorCode,subErrorCode:o.subError,success:!1}),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibility)})})}};export{g as a,U as b,Re as c,w as d,Y as e,I as f,zc as g,Yc as h,ce as i,_r as j,at as k,O as l,v as m,Mh as n,lr as o};
